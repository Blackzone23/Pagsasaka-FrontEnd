import{A as x,i as F,f as h,g as I,c as r,E as N,l as f,a as C,b as e,u as T,I as E,k as u,F as p,h as L,t as c,G as K,J as P,K as R,j as W,o}from"./index-uLLRMIoJ.js";import{L as G,T as H}from"./Toast-ChrbsX0y.js";/* empty css                                                              */const J={class:"bg-[#285a19] shadow p-4 flex justify-between items-center text-white"},U={class:"flex items-center space-x-4"},Y={class:"relative inline-block text-left"},$={class:"flex items-center space-x-2"},q=["src"],O={key:0,class:"absolute right-0 z-50 mt-2 w-48 bg-white rounded shadow-lg"},Q={class:"h-[90vh] flex flex-col md:flex-row"},X=["onClick"],Z=["src"],ee={class:"flex-1"},se={class:"font-medium block"},te={class:"text-sm text-gray-500"},ae={key:0,class:"text-xs bg-red-500 text-white px-2 py-1 rounded-full"},le={key:0,class:"flex flex-col h-full"},oe={class:"p-4 bg-gray-100 border-b flex justify-between items-center"},ne={class:"text-lg font-semibold"},re={class:"flex-1 bg-gray-50 p-4 overflow-auto space-y-4 2xl:text-sm 2xs:text-sm"},de=["src"],ie={class:"text-xs"},ue=["src"],ce={class:"p-4 border-t flex items-center bg-gray-50"},ve={key:1,class:"flex items-center justify-center flex-1 text-gray-500"},pe={__name:"FMessage",setup(xe){const d=F(),M=W(),S=x(()=>d.state.showLoading.state),_=x(()=>{var t;return((t=d.state.userData.data)==null?void 0:t.user)||{}}),w=x(()=>d.state.Consumer.conversation.data),j=x(()=>d.state.Consumer.message.data),g=h("path/to/default/avatar.png"),l=h(null),v=h(""),n=h(""),i=x(()=>{var t,a;return((a=(t=d.state.userData.data)==null?void 0:t.user)==null?void 0:a.id)||null}),m=h(!1),z=()=>{d.dispatch("Consumer/getConversation")};I(()=>{z(),y(),window.addEventListener("resize",y)});const D=t=>{const a=w.value.find(s=>s.id===t);a&&(l.value=a,d.dispatch("Consumer/getMessages",t))},V=()=>{l.value=null},b=async()=>{if(!v.value.trim()||!l.value)return;const t={id:l.value.id,message:v.value};try{await d.dispatch("Consumer/sendMessage",t),await d.dispatch("Consumer/getMessages",l.value.id),v.value=""}catch(a){console.error("Failed to send message:",a)}},y=()=>{const t=window.innerWidth;t<400?n.value="2xs":t<640?n.value="xs":t<768?n.value="sm":t<1024?n.value="md":t<1280?n.value="lg":t<1536?n.value="xl":n.value="2xl"},A=()=>{m.value=!m.value},B=async()=>{try{(await d.dispatch("logout")).isSuccess&&M.push({name:"Login"})}catch(t){console.error("Logout error:",t)}};return(t,a)=>(o(),r(p,null,[S.value?(o(),N(G,{key:0,class:"loading"})):f("",!0),C(H),e("header",J,[a[2]||(a[2]=e("h1",{class:"text-lg sm:text-xl 2xl:ml-0 md:ml-10 2xs:ml-10 font-bold"},"Message History",-1)),e("div",U,[e("div",Y,[e("div",$,[e("img",{src:_.value.avatar,alt:"Profile",class:"w-10 h-10 rounded-full object-cover shadow-md"},null,8,q),C(T(E),{icon:"uil:setting",width:"24",height:"24",class:"cursor-pointer text-white",onClick:A})]),m.value?(o(),r("div",O,[a[1]||(a[1]=e("a",{href:"/seller-profile",class:"block px-4 py-2 text-sm text-black hover:bg-gray-100"}," Account Info ",-1)),e("button",{onClick:B,class:"block w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100"}," Logout ")])):f("",!0)])])]),e("div",Q,[e("div",{class:u(["p-4 border-r shadow-lg overflow-y-auto transition-all duration-300",{"w-full md:w-1/3 bg-gray-100":!l.value||n.value!=="2xs","hidden md:block md:w-1/3 bg-gray-100":l.value&&n.value==="2xs"}])},[a[3]||(a[3]=e("div",{class:"flex justify-between"},[e("h2",{class:"text-lg text-[#1c520d] font-semibold mb-4"},"Chats")],-1)),e("ul",null,[(o(!0),r(p,null,L(w.value,s=>{var k;return o(),r("li",{key:s.id,onClick:he=>D(s.id),class:u(["p-2 cursor-pointer hover:bg-gray-200 rounded-md flex items-center",{"bg-blue-200":((k=l.value)==null?void 0:k.id)===s.id}])},[e("img",{src:s.chat_partner_avatar||g.value,alt:"Avatar",class:"w-10 h-10 rounded-full mr-3"},null,8,Z),e("div",ee,[e("span",se,c(s.chat_partner_name),1),e("span",te,c(s.message||"No messages"),1)]),s.unread_messages_count?(o(),r("span",ae,c(s.unread_messages_count),1)):f("",!0)],10,X)}),128))])],2),e("div",{class:u(["flex flex-col border-l shadow-lg h-full transition-all duration-300",{"w-full md:w-2/3 flex":l.value||n.value!=="2xs",hidden:!l.value&&n.value==="2xs"}])},[l.value?(o(),r("div",le,[e("div",oe,[e("h2",ne,c(l.value.chat_partner_name),1),e("button",{onClick:V,class:"text-gray-500"},"Close")]),e("div",re,[(o(!0),r(p,null,L(j.value,s=>(o(),r("div",{key:s.id,class:u(["flex items-start space-x-3",{"justify-end":s.sender.id===i.value,"justify-start":s.sender.id!==i.value}])},[s.sender.id!==i.value?(o(),r("img",{key:0,src:s.sender.avatar||g.value,class:"w-8 h-8 rounded-full"},null,8,de)):f("",!0),e("div",{class:u(["p-3 rounded-lg shadow-md w-auto max-w-xs",{"bg-green-500 text-white":s.sender.id===i.value,"bg-gray-200 text-black":s.sender.id!==i.value}])},[e("p",{class:u(["text-sm font-bold",{"text-white":s.sender.id===i.value,"text-green-600":s.sender.id!==i.value}])},c(s.sender.id===i.value?"You":s.sender.first_name+" "+s.sender.last_name),3),e("p",ie,c(s.message),1)],2),s.sender.id===i.value?(o(),r("img",{key:1,src:_.value.avatar||g.value,class:"w-8 h-8 rounded-full"},null,8,ue)):f("",!0)],2))),128))]),e("div",ce,[K(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>v.value=s),onKeyup:R(b,["enter"]),type:"text",class:"flex-1 p-2 border rounded-md",placeholder:"Type a message..."},null,544),[[P,v.value]]),e("button",{onClick:b,class:"ml-2 bg-green-500 text-white px-4 py-2 rounded-lg"},"Send")])])):(o(),r("div",ve,"Welcome to Pagsasaka Chat"))],2)])],64))}};export{pe as default};
