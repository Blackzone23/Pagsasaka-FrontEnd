import{A as x,i as xt,f as u,g as w,D as gt,c as l,b as t,l as p,a as z,u as v,I as B,k as C,G as S,H as $,Q as bt,d as E,F as h,h as _,t as r,j as ft,o as a}from"./index-XLSrkNqX.js";import{l as N}from"./lodash-0l3xrD9P.js";import{E as yt}from"./jspdf.es.min-DvxYAMgh.js";import ht from"./html2canvas.esm-CBrSDip1.js";const _t={class:"flex min-h-screen bg-gray-100"},kt={class:"flex-1 flex flex-col"},wt={class:"bg-[#285a19] shadow p-4 flex justify-between items-center text-white"},Ct={class:"flex items-center space-x-4"},Lt={class:"relative inline-block text-left"},St={class:"flex items-center space-x-2"},Dt=["src"],Ot={key:0,class:"absolute right-0 z-50 mt-2 w-48 bg-white rounded shadow-lg"},Ft={class:"p-5"},It={key:0},Ut={class:"mb-4 text-sm flex flex-wrap gap-2"},$t={key:0},Nt={class:"mb-4 flex items-center space-x-2"},Rt={class:"table-auto w-full border-collapse border border-gray-300"},Pt={key:0},Mt=["onClick"],Tt={class:"px-4 py-2"},jt={class:"px-4 py-2"},Vt={class:"px-4 py-2"},Wt={class:"px-4 py-2"},At={class:"px-4 py-2"},Ht={key:1},zt={colspan:"5",class:"px-4 py-2 text-center text-sm text-gray-500"},Bt={key:1},Et={class:"mb-4 flex items-center space-x-2"},Jt={class:"table-auto w-full border-collapse border border-gray-300"},qt={key:0},Gt=["onClick"],Qt={class:"px-4 py-2"},Yt={class:"px-4 py-2"},Kt={class:"px-4 py-2"},Xt={class:"px-4 py-2"},Zt={class:"px-4 py-2"},te={key:1},ee={colspan:"5",class:"px-4 py-2 text-center text-sm text-gray-500"},se={key:2},oe={class:"mb-4 flex items-center space-x-2"},le={class:"table-auto w-full border-collapse border border-gray-300"},ae={key:0},re=["onClick"],ne={class:"px-4 py-2"},de={class:"px-4 py-2"},ie={class:"px-4 py-2"},ce={class:"px-4 py-2"},ue={class:"px-4 py-2"},pe={key:1},ve={colspan:"5",class:"px-4 py-2 text-center text-sm text-gray-500"},me={class:"flex-1 text-center"},xe={class:"text-lg font-bold"},ge={class:"text-sm"},be={key:0},fe={class:"relative flex items-center justify-center mt-6"},ye={class:"flex space-x-10 md:space-x-[60px] z-10"},he={class:"flex space-x-4 md:space-x-[47px] justify-center items-center text-center mt-2 text-xs md:text-sm"},_e={class:"mt-8"},ke={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},we={class:"bg-white w-[700px] p-4 rounded-lg relative packing-slip-modal-content"},Ce={class:"mt-10 w-full"},Le={class:"text-center mb-2"},Se={class:"font-semibold"},De={class:"text-xs"},Oe={class:"grid grid-cols-2 gap-2 border-y py-2 mb-2"},Fe={class:"font-bold"},Ie=["innerHTML"],Ue={class:"font-bold"},$e=["innerHTML"],Ne={class:"grid grid-cols-4 gap-2 items-start border-b pb-2 mb-2"},Re={class:"col-span-1 flex flex-col items-center"},Pe={class:"text-xs text-gray-600"},Me={class:"col-span-3"},Te={class:"w-full text-left text-sm"},je={class:"py-1"},Ve={class:"text-xs text-gray-600"},We={class:"py-1"},Ae={class:"py-1"},He={class:"text-center font-semibold text-sm mt-4"},ze={class:"flex justify-center mt-4"},Be={key:0,class:"flex justify-center items-center mt-6 md:mt-0"},Ee=["src"],Ke={__name:"Shipment",setup(Je){const i=xt(),J=ft(),q=x(()=>i.state.User.order.data),R=x(()=>i.state.User.cancel.data),P=x(()=>i.state.User.refund.data),G=x(()=>i.state.User.print.data),D=x(()=>i.state.User.order.image),n=u(null),c=u("orders"),Q=x(()=>{var o;return((o=i.state.userData.data)==null?void 0:o.user)||{}}),g=u(""),b=u(""),f=u(""),m=u(""),O=o=>{if(!o)return null;const e={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"},[s,d,y]=o.split(" ");if(!s||!d||!y||!e[s])return console.warn(`Invalid date format: ${o}`),null;const k=`${y}-${e[s]}-${d.padStart(2,"0")}`;return console.log(`Input: ${o}, Formatted: ${k}`),k},M=x(()=>{let o=q.value;return g.value&&(o=o.filter(e=>O(e.created_at)===g.value)),m.value&&(o=o.filter(e=>e.status.toLowerCase()===m.value.toLowerCase())),o}),T=x(()=>{if(!b.value)return R.value;const o=R.value.filter(e=>O(e.created_at)===b.value);return console.log("Filtered Cancellations:",o),o}),j=x(()=>{if(!f.value)return P.value;const o=P.value.filter(e=>O(e.created_at)===f.value);return console.log("Filtered Refunds:",o),o}),L=N.debounce(()=>{},300),V=N.debounce(()=>{},300),W=N.debounce(()=>{},300),Y=()=>{m.value=""},K=()=>{g.value=""},X=()=>{b.value=""},Z=()=>{f.value=""};function tt(){i.dispatch("User/getOrderList")}w(()=>{tt()});function et(){i.dispatch("User/getImage")}w(()=>{et()});const st=o=>{n.value=o,i.dispatch("User/getImage",o.id)},F=[{id:"Order placed",label:"Order placed",icon:"hugeicons:package-process"},{id:"Waiting for courier",label:"Waiting for courier",icon:"ic:outline-local-shipping"},{id:"In transit",label:"In transit",icon:"la:shipping-fast"},{id:"Order delivered",label:"Order delivered",icon:"hugeicons:package-receive"}],ot=o=>{if(!n.value)return"bg-gray-300";const e=F.map(y=>y.id.toLowerCase()),s=e.indexOf(n.value.status.toLowerCase()),d=e.indexOf(o.toLowerCase());return d<s?"bg-green-500":d===s?"bg-[#608C54]":"bg-gray-300"},I=gt({id:"",status:""});async function lt(){if(!n.value)return;const o=["Order placed","Waiting for courier","In transit","Order delivered"],e=o.indexOf(n.value.status);if(e===-1||e===o.length-1)return;if(o[e]==="Waiting for courier"&&!H){console.warn("Slip not downloaded yet.");return}const s=o[e+1];I.id=n.value.id,I.status=s,await i.dispatch("User/updateStatus",I).then(d=>{d.isSuccess&&(n.value.status=s)}).catch(d=>{console.error("Error updating status:",d)})}function at(){i.dispatch("User/getCancelList")}w(()=>{at()});const rt=o=>{n.value=o};u(!1),u(null);function nt(){i.dispatch("User/getRefundList")}w(()=>{nt()});const dt=o=>{n.value=o};function it(o){i.dispatch("User/getPrintList",o)}w(()=>{it()});const A=u(!1),H=u(!1);function ct(){A.value=!1}const ut=()=>{const o=document.querySelector(".packing-slip-modal-content");if(!o){console.error("Modal content not found");return}ht(o).then(e=>{const s=e.toDataURL("image/png"),d=new yt,k=210-40,mt=e.height*k/e.width;d.addImage(s,"PNG",20,20,k,mt),d.save("packing-slip.pdf"),H.value=!0,ct()})},U=u(!1),pt=()=>{U.value=!U.value},vt=async()=>{try{(await i.dispatch("logout")).isSuccess&&J.push({name:"Login"})}catch(o){console.error("Logout error:",o)}};return(o,e)=>(a(),l("div",_t,[t("div",kt,[t("header",wt,[e[14]||(e[14]=t("h1",{class:"text-lg sm:text-xl 2xl:ml-0 md:ml-10 2xs:ml-10 font-bold"},"Shipment",-1)),t("div",Ct,[t("div",Lt,[t("div",St,[t("img",{src:Q.value.avatar,alt:"Profile",class:"w-10 h-10 rounded-full object-cover shadow-md"},null,8,Dt),z(v(B),{icon:"uil:setting",width:"24",height:"24",class:"cursor-pointer text-white",onClick:pt})]),U.value?(a(),l("div",Ot,[e[13]||(e[13]=t("a",{href:"/seller-profile",class:"block px-4 py-2 text-sm text-black hover:bg-gray-100"},"Account Info",-1)),t("button",{onClick:vt,class:"block w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100"},"Logout")])):p("",!0)])])]),t("div",Ft,[n.value?(a(),l("div",{key:1,class:C(["p-5 border-2 rounded-md mt-2 text-center flex flex-col md:flex-row items-center md:items-start",{"border-blue-300":n.value.status==="Order","border-red-300 text-red-600":n.value.status==="Cancelled","border-yellow-300 text-yellow-600":n.value.status==="Refund","border-[#608C54]":n.value.status!=="Order"&&n.value.status!=="Cancelled"&&n.value.status!=="Refund"}])},[t("div",me,[t("h1",xe,r(n.value.status)+" Shipment",1),t("p",ge,r(n.value.status==="Order"?"This shipment is currently being processed.":n.value.status==="Cancelled"?"This shipment has been cancelled. Contact customer support for assistance.":n.value.status==="Refund"?"You should receive the refund in your account shortly.":"Tracking Details"),1),n.value.status!=="Cancelled"&&n.value.status!=="Refund"?(a(),l("div",be,[t("div",fe,[e[24]||(e[24]=t("div",{class:"absolute w-3/4 md:w-[430px] h-1 bg-[#608C54] top-1/2 z-0"},null,-1)),t("div",ye,[(a(),l(h,null,_(F,s=>t("div",{key:s.id,class:C(["w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center",ot(s.id)])},[z(v(B),{icon:s.icon,class:"text-white w-6 h-6 md:w-8 md:h-8"},null,8,["icon"])],2)),64))])]),t("div",he,[(a(),l(h,null,_(F,s=>t("span",{key:s.id},r(s.label),1)),64))]),t("div",_e,[A.value?(a(),l("div",ke,[t("div",we,[t("div",Ce,[(a(!0),l(h,null,_(G.value,s=>(a(),l("div",{key:s.id,class:"bg-white p- border border-gray-400 rounded-lg text-sm font-sans"},[e[29]||(e[29]=E('<div class="flex justify-between items-center border-b pb-2 mb-2"><div class="flex items-center gap-2"><div><h1 class="text-lg font-bold text-green-700">Pagsasaka</h1><p class="text-xs text-gray-600">Farmers &amp; Consumer</p></div></div><div class="text-right"><p class="font-semibold text-lg">Logistics Logo</p></div></div>',1)),t("div",Le,[t("p",Se,"Product Name: "+r(s.orderId),1),t("p",De,r(s.orderId),1)]),t("div",Oe,[t("div",null,[e[25]||(e[25]=t("p",{class:"font-semibold border-b pb-1"},"Buyer",-1)),t("p",Fe,r(s.name),1),t("p",{innerHTML:s.address},null,8,Ie)]),t("div",null,[e[26]||(e[26]=t("p",{class:"font-semibold border-b pb-1"},"Seller",-1)),t("p",Ue,r(s.name),1),t("p",{innerHTML:s.address},null,8,$e)])]),t("div",Ne,[t("div",Re,[t("p",Pe,r(s.orderId),1)]),t("div",Me,[t("table",Te,[e[28]||(e[28]=t("thead",null,[t("tr",{class:"border-b"},[t("th",{class:"py-1"},"Product (Qty)"),t("th",{class:"py-1"},"Price"),t("th",{class:"py-1"},"Total")])],-1)),t("tbody",null,[(a(!0),l(h,null,_(o.order.items,(d,y)=>(a(),l("tr",{key:y},[t("td",je,[t("strong",null,r(d.name),1),e[27]||(e[27]=t("br",null,null,-1)),t("span",Ve,"Variants: "+r(d.variant),1)]),t("td",We,"₱"+r(d.price.toFixed(2)),1),t("td",Ae,"₱"+r((d.price*d.quantity).toFixed(2)),1)]))),128))])])])]),t("div",He," Order ID: "+r(o.order.orderId),1)]))),128))]),t("div",{class:"mt-4 text-center"},[t("button",{onClick:ut,class:"py-2 px-4 rounded-md bg-green-700 text-white"}," Download Packing Slip as PDF ")])])])):p("",!0)]),t("div",ze,[t("button",{onClick:e[11]||(e[11]=s=>lt()),class:"px-12 py-2 text-sm font-semibold rounded-lg shadow-md transition text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},"Approve")])])):p("",!0),t("button",{class:"mt-4 px-4 py-2 bg-gray-300 font-semibold rounded-lg shadow-md text-sm",onClick:e[12]||(e[12]=s=>n.value=null)}," Back to Shipments ")]),D.value&&D.value.delivery_proof?(a(),l("div",Be,[t("img",{src:D.value.delivery_proof,alt:"Shipment Image",class:"border border-gray-500 w-[280px] h-[300px] md:w-[350px] md:h-[400px] rounded-lg shadow-md object-cover"},null,8,Ee)])):p("",!0)],2)):(a(),l("div",It,[t("div",Ut,[t("button",{class:C(["px-4 py-2 rounded transition",{"bg-blue-500 text-white":c.value==="orders","bg-gray-200":c.value!=="orders"}]),onClick:e[0]||(e[0]=s=>c.value="orders")},"My Orders",2),t("button",{class:C(["px-4 py-2 rounded transition",{"bg-red-500 text-white":c.value==="cancellations","bg-gray-200":c.value!=="cancellations"}]),onClick:e[1]||(e[1]=s=>c.value="cancellations")},"Cancellations",2),t("button",{class:C(["px-4 py-2 rounded transition",{"bg-yellow-500 text-white":c.value==="refunds","bg-gray-200":c.value!=="refunds"}]),onClick:e[2]||(e[2]=s=>c.value="refunds")},"Return and Refund",2)]),c.value==="orders"?(a(),l("div",$t,[t("div",Nt,[e[16]||(e[16]=t("label",{for:"order-date-filter",class:"text-sm font-semibold"},"Filter by Date:",-1)),S(t("input",{id:"order-date-filter","onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),type:"date",class:"p-2 border rounded-md text-sm",onInput:e[4]||(e[4]=(...s)=>v(L)&&v(L)(...s))},null,544),[[$,g.value]]),g.value?(a(),l("button",{key:0,onClick:K,class:"px-3 py-1 bg-gray-300 text-sm rounded-md hover:bg-gray-400"}," Clear ")):p("",!0),e[17]||(e[17]=t("label",{for:"order-status-filter",class:"text-sm font-semibold"},"Filter by Status:",-1)),S(t("select",{id:"order-status-filter","onUpdate:modelValue":e[5]||(e[5]=s=>m.value=s),class:"p-2 border rounded-md text-sm",onChange:e[6]||(e[6]=(...s)=>v(L)&&v(L)(...s))},e[15]||(e[15]=[E('<option value="">All</option><option value="Order placed">Order placed</option><option value="Waiting for courier">Waiting for courier</option><option value="In transit">In transit</option><option value="Order delivered">Order delivered</option>',5)]),544),[[bt,m.value]]),m.value?(a(),l("button",{key:1,onClick:Y,class:"px-3 py-1 bg-gray-300 text-sm rounded-md hover:bg-gray-400"}," Clear Status ")):p("",!0)]),t("table",Rt,[e[18]||(e[18]=t("thead",null,[t("tr",{class:"bg-gray-300"},[t("th",{class:"px-4 py-2"},"Name"),t("th",{class:"px-4 py-2"},"Created"),t("th",{class:"px-4 py-2"},"Last Updated"),t("th",{class:"px-4 py-2"},"Ship To"),t("th",{class:"px-4 py-2"},"Status")])],-1)),M.value.length>0?(a(),l("tbody",Pt,[(a(!0),l(h,null,_(M.value,s=>(a(),l("tr",{key:s.id,class:"even:bg-gray-50 hover:bg-gray-200 text-center text-sm cursor-pointer",onClick:d=>st(s)},[t("td",Tt,r(s.product_name),1),t("td",jt,r(s.created_at),1),t("td",Vt,r(s.updated_at),1),t("td",Wt,r(s.ship_to),1),t("td",At,r(s.status),1)],8,Mt))),128))])):(a(),l("tbody",Ht,[t("tr",null,[t("td",zt,r(g.value||m.value?`No orders found for ${g.value||""} ${m.value?m.value:""}`:"No orders available"),1)])]))])])):p("",!0),c.value==="cancellations"?(a(),l("div",Bt,[t("div",Et,[e[19]||(e[19]=t("label",{for:"cancel-date-filter",class:"text-sm font-semibold"},"Filter by Date:",-1)),S(t("input",{id:"cancel-date-filter","onUpdate:modelValue":e[7]||(e[7]=s=>b.value=s),type:"date",class:"p-2 border rounded-md text-sm",onInput:e[8]||(e[8]=(...s)=>v(V)&&v(V)(...s))},null,544),[[$,b.value]]),b.value?(a(),l("button",{key:0,onClick:X,class:"px-3 py-1 bg-gray-300 text-sm rounded-md hover:bg-gray-400"}," Clear ")):p("",!0)]),t("table",Jt,[e[20]||(e[20]=t("thead",null,[t("tr",{class:"bg-gray-300"},[t("th",{class:"px-4 py-2"},"Name"),t("th",{class:"px-4 py-2"},"Created"),t("th",{class:"px-4 py-2"},"Last Updated"),t("th",{class:"px-4 py-2"},"Ship To"),t("th",{class:"px-4 py-2"},"Status")])],-1)),T.value.length>0?(a(),l("tbody",qt,[(a(!0),l(h,null,_(T.value,s=>(a(),l("tr",{key:s.id,class:"even:bg-gray-50 hover:bg-gray-200 text-center text-sm cursor-pointer",onClick:d=>rt(s)},[t("td",Qt,r(s.product_name),1),t("td",Yt,r(s.created_at),1),t("td",Kt,r(s.updated_at),1),t("td",Xt,r(s.ship_to),1),t("td",Zt,r(s.status),1)],8,Gt))),128))])):(a(),l("tbody",te,[t("tr",null,[t("td",ee,r(b.value?`No cancellations found for ${b.value}`:"No cancellations available"),1)])]))])])):p("",!0),c.value==="refunds"?(a(),l("div",se,[t("div",oe,[e[21]||(e[21]=t("label",{for:"refund-date-filter",class:"text-sm font-semibold"},"Filter by Date:",-1)),S(t("input",{id:"refund-date-filter","onUpdate:modelValue":e[9]||(e[9]=s=>f.value=s),type:"date",class:"p-2 border rounded-md text-sm",onInput:e[10]||(e[10]=(...s)=>v(W)&&v(W)(...s))},null,544),[[$,f.value]]),f.value?(a(),l("button",{key:0,onClick:Z,class:"px-3 py-1 bg-gray-300 text-sm rounded-md hover:bg-gray-400"}," Clear ")):p("",!0)]),t("table",le,[e[22]||(e[22]=t("thead",null,[t("tr",{class:"bg-gray-300"},[t("th",{class:"px-4 py-2"},"Name"),t("th",{class:"px-4 py-2"},"Created"),t("th",{class:"px-4 py-2"},"Last Updated"),t("th",{class:"px-4 py-2"},"Ship To"),t("th",{class:"px-4 py-2"},"Status")])],-1)),j.value.length>0?(a(),l("tbody",ae,[(a(!0),l(h,null,_(j.value,s=>(a(),l("tr",{key:s.id,class:"even:bg-gray-50 hover:bg-gray-200 text-center text-sm cursor-pointer",onClick:d=>dt(s)},[t("td",ne,r(s.product_name),1),t("td",de,r(s.created_at),1),t("td",ie,r(s.updated_at),1),t("td",ce,r(s.ship_to),1),t("td",ue,r(s.status),1)],8,re))),128))])):(a(),l("tbody",pe,[t("tr",null,[t("td",ve,r(f.value?`No refunds found for ${f.value}`:"No refunds available"),1)])]))])])):p("",!0),e[23]||(e[23]=t("div",{class:"p-5 border-2 border-gray-300 rounded-md mt-2 text-center"},[t("h1",{class:"text-lg font-bold"},"Select a Shipment"),t("p",{class:"text-sm"},"Please select a shipment from the table to view tracking details.")],-1))]))])])]))}};export{Ke as default};
