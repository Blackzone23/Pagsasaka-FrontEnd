import{A as v,i as F,f as x,g as I,c as r,E as T,l as h,a as C,b as e,u as E,I as N,k as u,F as p,h as L,t as f,G as H,H as K,J as P,j as R,o}from"./index-CpL9wR7w.js";import{L as W,T as G}from"./Toast-mhXOF29r.js";/* empty css                                                              */const J={class:"bg-[#285a19] shadow p-4 flex justify-between items-center text-white"},U={class:"flex items-center space-x-4"},Y={class:"relative inline-block text-left"},$={class:"flex items-center space-x-2"},q=["src"],O={key:0,class:"absolute right-0 z-50 mt-2 w-48 bg-white rounded shadow-lg"},Q={class:"h-[90vh] flex flex-col md:flex-row"},X=["onClick"],Z=["src"],ee={class:"flex-1"},te={class:"font-medium block"},se={key:0,class:"text-xs bg-red-500 text-white px-2 py-1 rounded-full"},ae={key:0,class:"flex flex-col h-full"},le={class:"p-4 bg-gray-100 border-b flex justify-between items-center"},oe={class:"text-lg font-semibold"},ne={class:"flex-1 bg-gray-50 p-4 overflow-auto space-y-4 2xl:text-sm 2xs:text-sm"},re=["src"],de={class:"text-xs"},ie=["src"],ue={class:"p-4 border-t flex items-center bg-gray-50"},ce={key:1,class:"flex items-center justify-center flex-1 text-gray-500"},me={__name:"FMessage",setup(ve){const d=F(),M=R(),S=v(()=>d.state.showLoading.state),_=v(()=>{var s;return((s=d.state.userData.data)==null?void 0:s.user)||{}}),w=v(()=>d.state.Consumer.conversation.data),j=v(()=>d.state.Consumer.message.data),g=x("path/to/default/avatar.png"),l=x(null),c=x(""),n=x(""),i=v(()=>{var s,a;return((a=(s=d.state.userData.data)==null?void 0:s.user)==null?void 0:a.id)||null}),m=x(!1),z=()=>{d.dispatch("Consumer/getConversation")};I(()=>{z(),y(),window.addEventListener("resize",y)});const D=s=>{const a=w.value.find(t=>t.id===s);a&&(l.value=a,d.dispatch("Consumer/getMessages",s))},V=()=>{l.value=null},b=async()=>{if(!c.value.trim()||!l.value)return;const s={id:l.value.id,message:c.value};try{await d.dispatch("Consumer/sendMessage",s),await d.dispatch("Consumer/getMessages",l.value.id),c.value=""}catch(a){console.error("Failed to send message:",a)}},y=()=>{const s=window.innerWidth;s<400?n.value="2xs":s<640?n.value="xs":s<768?n.value="sm":s<1024?n.value="md":s<1280?n.value="lg":s<1536?n.value="xl":n.value="2xl"},A=()=>{m.value=!m.value},B=async()=>{try{(await d.dispatch("logout")).isSuccess&&M.push({name:"Login"})}catch(s){console.error("Logout error:",s)}};return(s,a)=>(o(),r(p,null,[S.value?(o(),T(W,{key:0,class:"loading"})):h("",!0),C(G),e("header",J,[a[2]||(a[2]=e("h1",{class:"text-lg sm:text-xl 2xl:ml-0 md:ml-10 2xs:ml-10 font-bold"},"Message History",-1)),e("div",U,[e("div",Y,[e("div",$,[e("img",{src:_.value.avatar,alt:"Profile",class:"w-10 h-10 rounded-full object-cover shadow-md"},null,8,q),C(E(N),{icon:"uil:setting",width:"24",height:"24",class:"cursor-pointer text-white",onClick:A})]),m.value?(o(),r("div",O,[a[1]||(a[1]=e("a",{href:"/seller-profile",class:"block px-4 py-2 text-sm text-black hover:bg-gray-100"}," Account Info ",-1)),e("button",{onClick:B,class:"block w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100"}," Logout ")])):h("",!0)])])]),e("div",Q,[e("div",{class:u(["p-4 border-r shadow-lg overflow-y-auto transition-all duration-300",{"w-full md:w-1/3 bg-gray-100":!l.value||n.value!=="2xs","hidden md:block md:w-1/3 bg-gray-100":l.value&&n.value==="2xs"}])},[a[3]||(a[3]=e("div",{class:"flex justify-between"},[e("h2",{class:"text-lg text-[#1c520d] font-semibold mb-4"},"Chats")],-1)),e("ul",null,[(o(!0),r(p,null,L(w.value,t=>{var k;return o(),r("li",{key:t.id,onClick:xe=>D(t.id),class:u(["p-2 cursor-pointer hover:bg-gray-200 rounded-md flex items-center",{"bg-blue-200":((k=l.value)==null?void 0:k.id)===t.id}])},[e("img",{src:t.chat_partner_avatar||g.value,alt:"Avatar",class:"w-10 h-10 rounded-full mr-3"},null,8,Z),e("div",ee,[e("span",te,f(t.chat_partner_name),1)]),t.unread_messages_count?(o(),r("span",se,f(t.unread_messages_count),1)):h("",!0)],10,X)}),128))])],2),e("div",{class:u(["flex flex-col border-l shadow-lg h-full transition-all duration-300",{"w-full md:w-2/3 flex":l.value||n.value!=="2xs",hidden:!l.value&&n.value==="2xs"}])},[l.value?(o(),r("div",ae,[e("div",le,[e("h2",oe,f(l.value.chat_partner_name),1),e("button",{onClick:V,class:"text-gray-500"},"Close")]),e("div",ne,[(o(!0),r(p,null,L(j.value,t=>(o(),r("div",{key:t.id,class:u(["flex items-start space-x-3",{"justify-end":t.sender.id===i.value,"justify-start":t.sender.id!==i.value}])},[t.sender.id!==i.value?(o(),r("img",{key:0,src:t.sender.avatar||g.value,class:"w-8 h-8 rounded-full"},null,8,re)):h("",!0),e("div",{class:u(["p-3 rounded-lg shadow-md w-auto max-w-xs",{"bg-green-500 text-white":t.sender.id===i.value,"bg-gray-200 text-black":t.sender.id!==i.value}])},[e("p",{class:u(["text-sm font-bold",{"text-white":t.sender.id===i.value,"text-green-600":t.sender.id!==i.value}])},f(t.sender.id===i.value?"You":t.sender.first_name+" "+t.sender.last_name),3),e("p",de,f(t.message),1)],2),t.sender.id===i.value?(o(),r("img",{key:1,src:_.value.avatar||g.value,class:"w-8 h-8 rounded-full"},null,8,ie)):h("",!0)],2))),128))]),e("div",ue,[H(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),onKeyup:P(b,["enter"]),type:"text",class:"flex-1 p-2 border rounded-md",placeholder:"Type a message..."},null,544),[[K,c.value]]),e("button",{onClick:b,class:"ml-2 bg-green-500 text-white px-4 py-2 rounded-lg"},"Send")])])):(o(),r("div",ce,"Welcome to Pagsasaka Chat"))],2)])],64))}};export{me as default};
