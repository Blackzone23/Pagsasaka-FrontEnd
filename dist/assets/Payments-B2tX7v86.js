import{A as y,i as me,f as h,g as pe,p as O,c as v,E as ve,l as P,a as V,b as e,u as Y,I as B,k as C,t as c,F as T,h as A,d as ge,j as he,o as p,G as ye,$ as be}from"./index-CpL9wR7w.js";import{L as xe,T as fe}from"./Toast-mhXOF29r.js";import{E as we}from"./jspdf.es.min-CwrK9Wzg.js";/* empty css                                                              */const _e={class:"h-screen w-full"},Te={class:"bg-[#285a19] shadow p-4 flex justify-between items-center text-white"},Se={class:"flex items-center space-x-4"},ke={class:"relative inline-block text-left"},De={class:"flex items-center space-x-2"},Me=["src"],Pe={key:0,class:"absolute right-0 z-50 mt-2 w-48 bg-white rounded shadow-lg"},Ce={class:"container mx-auto p-4"},Ae={class:"flex flex-wrap items-center justify-between gap-4 mb-4"},Fe={class:"flex flex-wrap items-center gap-4"},Ee=["disabled"],Le={class:"text-sm sm:text-base font-semibold"},Re={key:0,class:"text-sm sm:text-base font-semibold"},$e={class:"overflow-x-auto"},Ne={class:"max-h-[400px] overflow-y-auto"},Ve={class:"w-full border-collapse border border-gray-300 rounded-md min-w-[600px]"},Ue={key:0,class:"text-center"},qe={class:"px-3 sm:px-4 py-2"},je={class:"px-3 sm:px-4 py-2"},Ie={class:"px-3 sm:px-4 py-2"},Oe={class:"text-blue-500"},Ye={class:"px-3 sm:px-4 py-2"},Be={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"},ze={class:"bg-white p-6 rounded-lg w-full max-w-md"},We={class:"grid grid-cols-1 gap-6"},Ge={class:"text-xs text-green-600"},Je={class:"flex justify-between items-center my-2"},Ke={class:"font-medium"},Qe={class:"mb-2"},He={class:"grid grid-cols-7 text-center text-xs"},Xe={class:"grid grid-cols-7 gap-1 text-center text-xs"},Ze=["onClick"],et={class:"space-y-2"},tt={class:"flex items-center"},st=["value","disabled"],at={class:"text-sm"},ot={class:"flex justify-between mt-6"},lt=["disabled"],f=3e3,dt={__name:"Payments",setup(nt){const l=me(),z=he(),W=y(()=>l.state.showLoading.state),S=y(()=>{var a;return((a=l.state.userData.data)==null?void 0:a.user)||{}}),F=y(()=>l.state.User.payment.data),E=h(!1),L=h(!1),n=h(null),g=h(null),w=h(!1),R=h(null),b=h(null),_=y(()=>{var a;return((a=R.value)==null?void 0:a.totalSales)||"0.00"}),$=async()=>{await G(),await q(),await J()};async function G(){try{await l.dispatch("User/getPayMent")}catch(a){console.error("Failed to fetch payment list:",a)}}async function J(){try{const t=((await l.dispatch("User/getPendingPayments")).data||[]).find(u=>u.account_id===S.value.id);if(t)b.value={date:t.date,time_slot:t.time_slot,status:t.status};else{const o=((await l.dispatch("User/getApprovedPayments")).data||[]).find(r=>r.account_id===S.value.id);b.value=o?{date:o.date,time_slot:o.time_slot,status:o.status}:null}}catch(a){console.error("Failed to fetch payout schedule:",a),b.value=null}}pe(()=>{$()});const K=y(()=>F.value&&F.value.length>0),Q=["Su","Mo","Tu","We","Th","Fr","Sa"],m=h(new Date(2025,4,1)),H=y(()=>m.value.toLocaleString("default",{month:"long"})),X=y(()=>m.value.getFullYear()),Z=y(()=>{const a=new Date,s=new Date(a);for(s.setDate(a.getDate()+1);!N(s);)s.setDate(s.getDate()+1);return s.toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"})}),k=h([]),ee=y(()=>{var r;const a=m.value.getFullYear(),s=m.value.getMonth(),t=new Date(a,s,1).getDay(),u=new Date(a,s+1,0).getDate(),i=new Date,o=[];for(let d=0;d<t;d++)o.push({day:"",isEmpty:!0});for(let d=1;d<=u;d++){const x=new Date(a,s,d),I=x<new Date(i.getFullYear(),i.getMonth(),i.getDate()),ce=!I&&N(x)&&(((r=D.value[x.toISOString().split("T")[0]])==null?void 0:r.totalAvailable)||0)>0,de=n.value&&x.getDate()===n.value.getDate()&&x.getMonth()===n.value.getMonth()&&x.getFullYear()===n.value.getFullYear();o.push({day:d,date:x,isAvailable:ce,isSelected:de,isPast:I,isEmpty:!1})}return o}),D=h({}),te=()=>{m.value=new Date(m.value.getFullYear(),m.value.getMonth()-1,1),n.value=null,g.value=null,M()},se=()=>{m.value=new Date(m.value.getFullYear(),m.value.getMonth()+1,1),n.value=null,g.value=null,M()},ae=a=>{a.isEmpty||a.isPast||!a.isAvailable||(n.value=a.date,g.value=null,U())},N=a=>{const s=a.getDay();return s!==0&&s!==6},U=()=>{var t;if(!n.value){k.value=[];return}const a=n.value.toISOString().split("T")[0],s=((t=D.value[a])==null?void 0:t.slots)||[];k.value=["10:00-11:00","11:00-12:00","12:00-13:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00"].map(u=>{const i=s.find(o=>o.time_slot===u)||{};return{time:u,isAvailable:i.is_available||!1,availableSlots:i.available_slots||null}})},M=async()=>{const a=m.value.getFullYear(),s=m.value.getMonth(),t=new Date(a,s,1).toISOString().split("T")[0],u=new Date(a,s+1,0).toISOString().split("T")[0];try{const i=await l.dispatch("User/getSlots",{date:`${t}/${u}`}),o={};i.forEach(r=>{const d=r.date;o[d]||(o[d]={slots:[],totalAvailable:0}),o[d].slots.push(r),r.is_available&&(o[d].totalAvailable+=r.available_slots||1)}),D.value=o}catch(i){console.error("Failed to fetch slots:",i)}};O(n,()=>{n.value&&U()}),O(m,()=>{M()});const oe=async()=>{try{l.dispatch("toggleLoader",!0);const s=await(await l.dispatch("User/getCSV")).text();try{const t=JSON.parse(s);if(!t.isSuccess)throw new Error(t.message||"Failed to export CSV")}catch(t){if(t.message&&t.message!=="Failed to export CSV"){const u=new Blob([s],{type:"text/csv;charset=utf-8"}),i=window.URL.createObjectURL(u),o=document.createElement("a");o.href=i,o.setAttribute("download",`payment_history_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i),l.commit("showToast",{showToast:!0,toastMessage:"CSV exported successfully",toastType:"success"}),setTimeout(()=>{l.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"})},f)}else throw t}}catch(a){a.message!=="No payment history found."&&console.error("Export CSV error:",a),l.commit("showToast",{showToast:!0,toastMessage:a.message||"Failed to export CSV",toastType:"error"}),setTimeout(()=>{l.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"})},f)}finally{l.dispatch("toggleLoader",!1)}},q=async()=>{try{const a=await l.dispatch("User/checkPayoutEligibility");R.value=a,w.value=a.eligible}catch(a){console.error("Eligibility check failed:",a),R.value=null,w.value=!1}},le=async()=>{await q(),w.value?(L.value=!0,M()):(l.commit("showToast",{showToast:!0,toastMessage:`You are not eligible for a payout. Total sales (₱${_.value}) must be at least ₱500 or you have a pending payout request.`,toastType:"error"}),setTimeout(()=>{l.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"})},f))},j=()=>{n.value=null,g.value=null,L.value=!1,D.value={},k.value=[]},ne=()=>["apple","banana","cherry","date","elderberry","fig","grape","honeydew","kiwi","lemon","mango","nectarine","orange","papaya","quince","raspberry","strawberry","tangerine","ugli","watermelon"].sort(()=>.5-Math.random()).slice(0,10).join("-"),ie=async()=>{if(!n.value||!g.value){l.commit("showToast",{showToast:!0,toastMessage:"Please select a date and time",toastType:"error"}),setTimeout(()=>{l.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"})},f);return}if(!w.value||parseFloat(_.value)<500){l.commit("showToast",{showToast:!0,toastMessage:`You are not eligible for a payout. Total sales (₱${_.value}) must be at least ₱500.`,toastType:"error"}),setTimeout(()=>{l.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"})},f);return}l.dispatch("toggleLoader",!0);const a=n.value.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),s=n.value.toISOString().split("T")[0],t=ne(),u={date:s,time_slot:g.value,total_sales:parseFloat(_.value),validation_code:t};try{const i=await l.dispatch("User/requestPayout",u);if(!i.isSuccess)throw new Error(i.message||"Failed to request payout");const o={sellerName:S.value.name||"N/A",date:a,time:g.value,totalSales:`₱${_.value}`,appointmentType:"Payout Request",validationCode:t,queueNumber:i.payout.queue_number},r=new we;r.setFontSize(16),r.text("Schedule Slip",20,20),r.setFontSize(12),r.text(`Seller: ${o.sellerName}`,20,40),r.text(`Date: ${o.date}`,20,50),r.text(`Time: ${o.time}`,20,60),r.text(`Total Sales: ${o.totalSales}`,20,70),r.text(`Appointment Type: ${o.appointmentType}`,20,80),r.text(`Validation Code: ${o.validationCode}`,20,90),r.text(`Queue Number: ${o.queueNumber}`,20,100);const d=`schedule-slip-${s}.pdf`;r.save(d),l.commit("showToast",{showToast:!0,toastMessage:"Payout request submitted and schedule slip downloaded",toastType:"success"}),setTimeout(()=>{l.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"})},f),j(),await $()}catch(i){console.error("Payout request failed:",i),l.commit("showToast",{showToast:!0,toastMessage:i.message||"Failed to request payout. Please try again.",toastType:"error"}),setTimeout(()=>{l.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"})},f)}finally{l.dispatch("toggleLoader",!1)}},re=()=>{E.value=!E.value},ue=async()=>{try{(await l.dispatch("logout")).isSuccess&&z.push({name:"Login"})}catch(a){console.error("Logout error:",a)}};return(a,s)=>(p(),v(T,null,[W.value?(p(),ve(xe,{key:0,class:"loading"})):P("",!0),V(fe),e("div",_e,[e("header",Te,[s[2]||(s[2]=e("h1",{class:"text-lg sm:text-xl 2xl:ml-0 md:ml-10 2xs:ml-10 font-bold"},"Payment Transaction",-1)),e("div",Se,[e("div",ke,[e("div",De,[e("img",{src:S.value.avatar,alt:"Profile",class:"w-10 h-10 rounded-full object-cover shadow-md"},null,8,Me),V(Y(B),{icon:"uil:setting",width:"24",height:"24",class:"cursor-pointer text-white",onClick:re})]),E.value?(p(),v("div",Pe,[s[1]||(s[1]=e("a",{href:"/seller-profile",class:"block px-4 py-2 text-sm text-black hover:bg-gray-100"}," Account Info ",-1)),e("button",{onClick:ue,class:"block w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100"}," Logout ")])):P("",!0)])])]),e("div",Ce,[e("div",Ae,[e("div",Fe,[e("button",{onClick:$,class:"bg-[#608C54] py-2 px-4 sm:px-6 text-white rounded-md flex items-center gap-1 hover:bg-gray-700 transition"},[V(Y(B),{icon:"material-symbols-light:refresh",width:"20",height:"20"}),s[3]||(s[3]=e("span",{class:"hidden sm:inline"},"Refresh",-1))]),e("button",{onClick:oe,class:"bg-gray-300 py-2 px-4 rounded-md text-sm sm:text-base hover:bg-gray-400 transition"}," Export to CSV "),e("button",{onClick:le,disabled:!w.value,class:C(["bg-[#285a19] py-2 px-4 rounded-md text-sm sm:text-base text-white hover:bg-gray-700 transition",{"bg-gray-300 cursor-not-allowed":!w.value}])}," Request a Payout ",10,Ee),e("div",Le,"Total Sales: ₱"+c(_.value),1)]),b.value?(p(),v("div",Re,[s[4]||(s[4]=e("div",null,"Payout Schedule:",-1)),e("div",null,"Date: "+c(b.value.date),1),e("div",null,"Time: "+c(b.value.time_slot),1),e("div",null,"Status: "+c(b.value.status),1)])):P("",!0)]),s[7]||(s[7]=e("div",{class:"mb-3 space-y-3"},[e("p",{class:"text-xs sm:text-sm md:text-base"},"View the payment history here. It might take some time for payments to appear in the portal.")],-1)),e("div",$e,[e("div",Ne,[e("table",Ve,[s[6]||(s[6]=e("thead",{class:"sticky top-0 bg-gray-300 z-10"},[e("tr",{class:"text-xs sm:text-sm md:text-md"},[e("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"}," Date "),e("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"}," Product Name "),e("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"}," Payment Method "),e("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"}," Amount ")])],-1)),e("tbody",null,[K.value?(p(!0),v(T,{key:1},A(F.value,t=>(p(),v("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-gray-200 text-xs sm:text-sm"},[e("td",qe,c(t.date),1),e("td",je,c(t.product_name),1),e("td",Ie,[e("span",Oe,c(t.payment_method),1)]),e("td",Ye,"₱"+c(t.amount),1)]))),128)):(p(),v("tr",Ue,s[5]||(s[5]=[e("td",{colspan:"4",class:"px-3 sm:px-4 py-2 text-xs sm:text-sm"},"No transactions found.",-1)])))])])])])]),L.value?(p(),v("div",Be,[e("div",ze,[s[12]||(s[12]=e("h2",{class:"text-lg font-bold mb-4"},"Request a Payout",-1)),e("div",We,[e("div",null,[s[8]||(s[8]=e("div",{class:"text-sm font-medium"},"Date",-1)),e("div",Ge,"Earliest available appointment: "+c(Z.value),1),s[9]||(s[9]=e("div",{class:"text-xs text-red-500"},"To the extent possible, additional slots are made regularly.",-1)),e("div",Je,[e("button",{onClick:te,class:"text-blue-500 font-bold"},"«"),e("span",Ke,c(H.value)+" "+c(X.value),1),e("button",{onClick:se,class:"text-blue-500 font-bold"},"»")]),e("div",Qe,[e("div",He,[(p(),v(T,null,A(Q,t=>e("div",{key:t,class:"py-1"},c(t.substring(0,2)),1)),64))]),e("div",Xe,[(p(!0),v(T,null,A(ee.value,t=>(p(),v("div",{key:t.day+t.isEmpty,class:C(["py-1 px-1",t.isEmpty?"text-gray-300":"cursor-pointer",t.isSelected?"bg-blue-500 text-white":"",!t.isEmpty&&!t.isSelected?t.isAvailable?"bg-green-100":"bg-red-100":""]),onClick:u=>t.isEmpty||!t.isAvailable||t.isPast||!N(t.date)?null:ae(t)},c(t.day),11,Ze))),128))])]),s[10]||(s[10]=ge('<div class="flex gap-4 mt-1 text-xs"><div class="flex items-center"><span class="w-4 h-4 bg-green-100 inline-block mr-1"></span> Available </div><div class="flex items-center"><span class="w-4 h-4 bg-red-100 inline-block mr-1"></span> Fully Booked </div></div>',1))]),e("div",null,[s[11]||(s[11]=e("div",{class:"text-sm font-medium mb-2"},"Time",-1)),e("div",et,[(p(!0),v(T,null,A(k.value,(t,u)=>(p(),v("div",{key:u,class:"flex justify-between items-center"},[e("label",tt,[ye(e("input",{type:"radio",value:t.time,"onUpdate:modelValue":s[0]||(s[0]=i=>g.value=i),class:"mr-2",disabled:!t.isAvailable||!n.value},null,8,st),[[be,g.value]]),e("span",at,c(t.time),1)]),e("span",{class:C([{"text-green-600":t.isAvailable&&n.value,"text-red-500":!t.isAvailable&&n.value,"text-gray-400":!n.value},"text-sm"])},c(t.isAvailable&&n.value?t.availableSlots?`Available Slots: ${t.availableSlots}`:"Available":n.value?"Fully Booked":""),3)]))),128))])])]),e("div",ot,[e("button",{onClick:j,class:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-8 rounded"}," BACK "),e("button",{onClick:ie,disabled:!n.value||!g.value,class:C(["py-2 px-8 rounded text-white",!n.value||!g.value?"bg-gray-300":"bg-blue-500 hover:bg-blue-600"])}," CONFIRM ",10,lt)])])])):P("",!0)])],64))}};export{dt as default};
