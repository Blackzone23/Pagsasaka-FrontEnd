import{A as g,i as we,f as y,g as _e,p as H,c as p,E as Se,l as k,a as $,b as t,u as w,I as j,k as T,t as c,G as q,H as ke,e as De,Q as Pe,F as D,h as L,d as Ce,j as Fe,o as u,a1 as Ae}from"./index-DqOZUVaT.js";import{L as Me,T as Ee}from"./Toast-r91SEUx0.js";import{l as J}from"./lodash-Ba6rcQbE.js";import{E as $e}from"./jspdf.es.min-BbMKBR72.js";import{l as Te}from"./Logo2-PGDhhV9I.js";/* empty css                                                              */const Le={class:"h-screen w-full"},Ne={class:"bg-[#285a19] shadow p-4 flex justify-between items-center text-white"},Re={class:"flex items-center space-x-4"},Ie={class:"relative inline-block text-left"},Ue={class:"flex items-center space-x-2"},Ve=["src"],Oe={key:0,class:"absolute right-0 z-50 mt-2 w-48 bg-white rounded shadow-lg"},je={class:"container mx-auto p-4"},qe={class:"flex flex-wrap items-center justify-between gap-4 mb-4"},Ye={class:"flex flex-wrap items-center gap-4"},Be=["disabled"],ze={class:"text-sm sm:text-base font-semibold"},We={key:0,class:"text-sm sm:text-base font-semibold"},Qe={class:"mb-3 space-y-3"},Ge={class:"flex items-center space-x-2"},He={class:"flex items-center space-x-2"},Je={class:"overflow-x-auto"},Ke={class:"max-h-[400px] overflow-y-auto"},Xe={class:"w-full border-collapse border border-gray-300 rounded-md min-w-[600px]"},Ze={key:0,class:"text-center"},et={colspan:"4",class:"px-3 sm:px-4 py-2 text-xs sm:text-sm"},tt={class:"px-3 sm:px-4 py-2"},st={class:"px-3 sm:px-4 py-2"},at={class:"px-3 sm:px-4 py-2"},ot={class:"text-blue-500"},lt={class:"px-3 sm:px-4 py-2"},nt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"},rt={class:"bg-white p-6 rounded-lg w-full max-w-md"},it={class:"grid grid-cols-1 gap-6"},dt={class:"text-xs text-green-600"},ct={class:"flex justify-between items-center my-2"},ut={class:"font-medium"},pt={class:"mb-2"},mt={class:"grid grid-cols-7 text-center text-xs"},vt={class:"grid grid-cols-7 gap-1 text-center text-xs"},yt=["onClick"],bt={class:"space-y-2"},gt={class:"flex items-center"},ht=["value","disabled"],xt={class:"text-sm"},ft={class:"flex justify-between mt-6"},wt=["disabled"],At={__name:"Payments",setup(_t){const m=we(),K=Fe(),X=g(()=>m.state.showLoading.state),P=g(()=>{var a;return((a=m.state.userData.data)==null?void 0:a.user)||{}}),N=g(()=>m.state.User.payment.data),R=y(!1),I=y(!1),i=y(null),b=y(null),_=y(!1),U=y(null),x=y(null),h=y(""),S=y(""),C=g(()=>{let a=N.value||[];return h.value&&(a=a.filter(e=>ee(e.date)===h.value)),S.value&&(a=a.filter(e=>e.payment_method===S.value)),a}),Y=J.debounce(()=>{},300),Z=()=>{S.value=""},ee=a=>{if(!a)return null;const e=/^(\d{2})\/(\d{2})\/(\d{4})$/,s=a.match(e);if(s){const[,n,l,o]=s,r=`${o}-${n.padStart(2,"0")}-${l.padStart(2,"0")}`,d=new Date(r);if(d.getFullYear()===parseInt(o)&&d.getMonth()+1===parseInt(n)&&d.getDate()===parseInt(l))return r}return console.warn(`Invalid date format: ${a}`),null},B=J.debounce(()=>{},300),te=()=>{h.value=""},F=g(()=>{var a;return((a=U.value)==null?void 0:a.totalSales)||"0.00"}),V=async()=>{await se(),await W(),await ae()};async function se(){try{await m.dispatch("User/getPayMent")}catch(a){console.error("Failed to fetch payment list:",a)}}async function ae(){try{const s=((await m.dispatch("User/getPendingPayments")).data||[]).find(n=>n.account_id===P.value.id);if(s)x.value={date:s.date,time_slot:s.time_slot,status:s.status};else{const o=((await m.dispatch("User/getApprovedPayments")).data||[]).find(r=>r.account_id===P.value.id);x.value=o?{date:o.date,time_slot:o.time_slot,status:o.status}:null}}catch(a){console.error("Failed to fetch payout schedule:",a),x.value=null}}_e(()=>{V()}),g(()=>N.value&&N.value.length>0);const oe=["Su","Mo","Tu","We","Th","Fr","Sa"],v=y(new Date(2025,4,1)),le=g(()=>v.value.toLocaleString("default",{month:"long"})),ne=g(()=>v.value.getFullYear()),re=g(()=>{const a=new Date,e=new Date(a);for(e.setDate(a.getDate()+1);!O(e);)e.setDate(e.getDate()+1);return e.toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"})}),A=y([]),ie=g(()=>{var r;const a=v.value.getFullYear(),e=v.value.getMonth(),s=new Date(a,e,1).getDay(),n=new Date(a,e+1,0).getDate(),l=new Date,o=[];for(let d=0;d<s;d++)o.push({day:"",isEmpty:!0});for(let d=1;d<=n;d++){const f=new Date(a,e,d),G=f<new Date(l.getFullYear(),l.getMonth(),l.getDate()),xe=!G&&O(f)&&(((r=M.value[f.toISOString().split("T")[0]])==null?void 0:r.totalAvailable)||0)>0,fe=i.value&&f.getDate()===i.value.getDate()&&f.getMonth()===i.value.getMonth()&&f.getFullYear()===i.value.getFullYear();o.push({day:d,date:f,isAvailable:xe,isSelected:fe,isPast:G,isEmpty:!1})}return o}),M=y({}),de=()=>{v.value=new Date(v.value.getFullYear(),v.value.getMonth()-1,1),i.value=null,b.value=null,E()},ce=()=>{v.value=new Date(v.value.getFullYear(),v.value.getMonth()+1,1),i.value=null,b.value=null,E()},ue=a=>{a.isEmpty||a.isPast||!a.isAvailable||(i.value=a.date,b.value=null,z())},O=a=>{const e=a.getDay();return e!==0&&e!==6},z=()=>{var s;if(!i.value){A.value=[];return}const a=i.value.toISOString().split("T")[0],e=((s=M.value[a])==null?void 0:s.slots)||[];A.value=["10:00-11:00","11:00-12:00","12:00-13:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00"].map(n=>{const l=e.find(o=>o.time_slot===n)||{};return{time:n,isAvailable:l.is_available||!1,availableSlots:l.available_slots||null}})},E=async()=>{const a=v.value.getFullYear(),e=v.value.getMonth(),s=new Date(a,e,1).toISOString().split("T")[0],n=new Date(a,e+1,0).toISOString().split("T")[0];try{const l=await m.dispatch("User/getSlots",{date:`${s}/${n}`}),o={};l.forEach(r=>{const d=r.date;o[d]||(o[d]={slots:[],totalAvailable:0}),o[d].slots.push(r),r.is_available&&(o[d].totalAvailable+=r.available_slots||1)}),M.value=o}catch(l){console.error("Failed to fetch slots:",l)}};H(i,()=>{i.value&&z()}),H(v,()=>{E()});const pe=async()=>{try{m.dispatch("toggleLoader",!0);const e=await(await m.dispatch("User/getCSV")).text();try{const s=JSON.parse(e);if(!s.isSuccess)throw new Error(s.message||"Failed to export CSV")}catch(s){if(s.message&&s.message!=="Failed to export CSV"){const n=new Blob([e],{type:"text/csv;charset=utf-8"}),l=window.URL.createObjectURL(n),o=document.createElement("a");o.href=l,o.setAttribute("download",`payment_history_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(l)}else throw s}}catch(a){a.message!=="No payment history found."&&console.error("Export CSV error:",a)}finally{m.dispatch("toggleLoader",!1)}},W=async()=>{try{const a=await m.dispatch("User/checkPayoutEligibility");U.value=a,_.value=a.eligible}catch(a){console.error("Eligibility check failed:",a),U.value=null,_.value=!1}},me=async()=>{await W(),_.value&&(I.value=!0,E())},Q=()=>{i.value=null,b.value=null,I.value=!1,M.value={},A.value=[]},ve=()=>["apple","banana","cherry","date","elderberry","fig","grape","honeydew","kiwi","lemon","mango","nectarine","orange","papaya","quince","raspberry","strawberry","tangerine","ugli","watermelon"].sort(()=>.5-Math.random()).slice(0,10).join("-"),ye=async()=>{if(!i.value||!b.value||!_.value||parseFloat(F.value)<500)return;const a=i.value.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),e=i.value.toISOString().split("T")[0],s=ve(),n={date:e,time_slot:b.value,total_sales:parseFloat(F.value),validation_code:s};try{const l=await m.dispatch("User/requestPayout",n);if(!l.isSuccess)throw new Error(l.message||"Failed to request payout");const o={sellerName:P.value.name||"N/A",date:a,time:b.value,totalSales:`₱${F.value}`,appointmentType:"Payout Request",validationCode:s,queueNumber:l.payout.queue_number},r=new $e;r.setFontSize(16),r.text("Schedule Slip",20,20),r.setFontSize(12),r.text(`Seller: ${o.sellerName}`,20,40),r.text(`Date: ${o.date}`,20,50),r.text(`Time: ${o.time}`,20,60),r.text(`Total Sales: ${o.totalSales}`,20,70),r.text(`Appointment Type: ${o.appointmentType}`,20,80),r.text(`Validation Code: ${o.validationCode}`,20,90),r.text(`Queue Number: ${o.queueNumber}`,20,100);const d=`schedule-slip-${e}.pdf`;r.save(d),Q(),await V()}catch(l){console.error("Payout request failed:",l)}},be=()=>{const a=window.open("","_blank");let e=`
    <html>
    <head>
      <title>Pagsasaka Report</title>
      <style>
        body { font-family: Arial, sans-serif; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        h1 { text-align: start; font-size: 1.5rem; } 
        .logo { max-width: 200px; display: block; margin: 0 auto 20px; }
      </style>
    </head>
    <body>
      <img src="${Te}" class="logo" alt="Company Logo" />
     	<h1>Payment Record</h1>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Product Name</th>
            <th>Payment Method</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
`;C.value.length>0?C.value.forEach(n=>{e+=`
        <tr>
          <td>${n.date}</td>
          <td>${n.product_name}</td>
          <td>${n.payment_method}</td>
          <td>${n.amount}</td>
        </tr>
      `}):e+=`
      <tr>
        <td colspan="5">No orders found for the selected filters</td>
      </tr>
    `,e+=`
        </tbody>
      </table>
    </body>
    </html>
  `,a.document.write(e),a.document.close();const s=a.document.querySelector(".logo");s?(s.onload=()=>{a.focus(),a.print(),a.close()},s.onerror=()=>{console.error("Failed to load logo image"),a.focus(),a.print(),a.close()}):(a.focus(),a.print(),a.close())},ge=()=>{R.value=!R.value},he=async()=>{try{(await m.dispatch("logout")).isSuccess&&K.push({name:"Login"})}catch(a){console.error("Logout error:",a)}};return(a,e)=>(u(),p(D,null,[X.value?(u(),Se(Me,{key:0,class:"loading"})):k("",!0),$(Ee),t("div",Le,[t("header",Ne,[e[6]||(e[6]=t("h1",{class:"text-lg sm:text-xl 2xl:ml-0 md:ml-10 2xs:ml-10 font-bold"},"Payment Transaction",-1)),t("div",Re,[t("div",Ie,[t("div",Ue,[t("img",{src:P.value.avatar,alt:"Profile",class:"w-10 h-10 rounded-full object-cover shadow-md"},null,8,Ve),$(w(j),{icon:"uil:setting",width:"24",height:"24",class:"cursor-pointer text-white",onClick:ge})]),R.value?(u(),p("div",Oe,[e[5]||(e[5]=t("a",{href:"/seller-profile",class:"block px-4 py-2 text-sm text-black hover:bg-gray-100"}," Account Info ",-1)),t("button",{onClick:he,class:"block w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100"}," Logout ")])):k("",!0)])])]),t("div",je,[t("div",qe,[t("div",Ye,[t("button",{onClick:V,class:"bg-[#608C54] py-2 px-4 sm:px-6 text-white rounded-md flex items-center gap-1 hover:bg-gray-700 transition"},[$(w(j),{icon:"material-symbols-light:refresh",width:"20",height:"20"}),e[7]||(e[7]=t("span",{class:"hidden sm:inline"},"Refresh",-1))]),t("button",{onClick:pe,class:"bg-gray-300 py-2 px-4 rounded-md text-sm sm:text-base hover:bg-gray-400 transition"}," Export to CSV "),t("button",{onClick:me,disabled:!_.value,class:T(["bg-[#285a19] py-2 px-4 rounded-md text-sm sm:text-base text-white hover:bg-gray-700 transition",{"bg-gray-300 cursor-not-allowed":!_.value}])}," Request a Payout ",10,Be),t("div",ze,"Total Sales: ₱"+c(F.value),1)]),x.value?(u(),p("div",We,[e[8]||(e[8]=t("div",null,"Payout Schedule:",-1)),t("div",null,"Date: "+c(x.value.date),1),t("div",null,"Time: "+c(x.value.time_slot),1),t("div",null,"Status: "+c(x.value.status),1)])):k("",!0)]),t("div",Qe,[e[13]||(e[13]=t("p",{class:"text-xs sm:text-sm md:text-base"},"View the payment history here. It might take some time for payments to appear in the portal.",-1)),t("div",Ge,[e[10]||(e[10]=t("label",{for:"payment-date-filter",class:"text-sm font-semibold"},"Filter by Date:",-1)),q(t("input",{id:"payment-date-filter","onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),type:"date",class:"p-2 border rounded-md text-sm",onInput:e[1]||(e[1]=(...s)=>w(B)&&w(B)(...s))},null,544),[[ke,h.value]]),h.value?(u(),p("button",{key:0,onClick:te,class:"px-3 py-1 bg-gray-300 text-sm rounded-md hover:bg-gray-400"}," Clear ")):k("",!0),t("button",{onClick:be,class:"flex items-center gap-2 px-3 py-1 xs:px-4 xs:py-1 bg-green-700 text-white text-xs sm:text-sm rounded-md hover:bg-green-600"},[$(w(j),{icon:"arcticons:print",width:"24",height:"24",style:{color:"#f9fffb"}}),e[9]||(e[9]=De("Print "))])]),t("div",He,[e[12]||(e[12]=t("label",{for:"payment-method-filter",class:"text-sm font-semibold"},"Filter by Payment Method:",-1)),q(t("select",{id:"payment-method-filter","onUpdate:modelValue":e[2]||(e[2]=s=>S.value=s),class:"p-2 border rounded-md text-sm",onChange:e[3]||(e[3]=(...s)=>w(Y)&&w(Y)(...s))},e[11]||(e[11]=[t("option",{value:""},"All",-1),t("option",{value:"E-Wallet"},"E-wallet",-1),t("option",{value:"COD"},"COD",-1)]),544),[[Pe,S.value]]),S.value?(u(),p("button",{key:0,onClick:Z,class:"px-3 py-1 bg-gray-300 text-sm rounded-md hover:bg-gray-400"}," Clear ")):k("",!0)])]),t("div",Je,[t("div",Ke,[t("table",Xe,[e[14]||(e[14]=t("thead",{class:"sticky top-0 bg-gray-300 z-10"},[t("tr",{class:"text-xs sm:text-sm md:text-md"},[t("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"},"Date"),t("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"},"Product Name"),t("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"},"Payment Method"),t("th",{class:"px-3 sm:px-4 py-2 text-left border-b border-gray-300"},"Amount")])],-1)),t("tbody",null,[C.value.length?(u(!0),p(D,{key:1},L(C.value,s=>(u(),p("tr",{key:s.id,class:"border-b border-gray-200 hover:bg-gray-200 text-xs sm:text-sm"},[t("td",tt,c(s.date),1),t("td",st,c(s.product_name),1),t("td",at,[t("span",ot,c(s.payment_method),1)]),t("td",lt,"₱"+c(s.amount),1)]))),128)):(u(),p("tr",Ze,[t("td",et,c(h.value?`No transactions found for ${h.value}`:"No transactions found."),1)]))])])])])]),I.value?(u(),p("div",nt,[t("div",rt,[e[19]||(e[19]=t("h2",{class:"text-lg font-bold mb-4"},"Request a Payout",-1)),t("div",it,[t("div",null,[e[15]||(e[15]=t("div",{class:"text-sm font-medium"},"Date",-1)),t("div",dt,"Earliest available appointment: "+c(re.value),1),e[16]||(e[16]=t("div",{class:"text-xs text-red-500"},"To the extent possible, additional slots are made regularly.",-1)),t("div",ct,[t("button",{onClick:de,class:"text-blue-500 font-bold"},"«"),t("span",ut,c(le.value)+" "+c(ne.value),1),t("button",{onClick:ce,class:"text-blue-500 font-bold"},"»")]),t("div",pt,[t("div",mt,[(u(),p(D,null,L(oe,s=>t("div",{key:s,class:"py-1"},c(s.substring(0,2)),1)),64))]),t("div",vt,[(u(!0),p(D,null,L(ie.value,s=>(u(),p("div",{key:s.day+s.isEmpty,class:T(["py-1 px-1",s.isEmpty?"text-gray-300":"cursor-pointer",s.isSelected?"bg-blue-500 text-white":"",!s.isEmpty&&!s.isSelected?s.isAvailable?"bg-green-100":"bg-red-100":""]),onClick:n=>s.isEmpty||!s.isAvailable||s.isPast||!O(s.date)?null:ue(s)},c(s.day),11,yt))),128))])]),e[17]||(e[17]=Ce('<div class="flex gap-4 mt-1 text-xs"><div class="flex items-center"><span class="w-4 h-4 bg-green-100 inline-block mr-1"></span> Available </div><div class="flex items-center"><span class="w-4 h-4 bg-red-100 inline-block mr-1"></span> Fully Booked </div></div>',1))]),t("div",null,[e[18]||(e[18]=t("div",{class:"text-sm font-medium mb-2"},"Time",-1)),t("div",bt,[(u(!0),p(D,null,L(A.value,(s,n)=>(u(),p("div",{key:n,class:"flex justify-between items-center"},[t("label",gt,[q(t("input",{type:"radio",value:s.time,"onUpdate:modelValue":e[4]||(e[4]=l=>b.value=l),class:"mr-2",disabled:!s.isAvailable||!i.value},null,8,ht),[[Ae,b.value]]),t("span",xt,c(s.time),1)]),t("span",{class:T([{"text-green-600":s.isAvailable&&i.value,"text-red-500":!s.isAvailable&&i.value,"text-gray-400":!i.value},"text-sm"])},c(s.isAvailable&&i.value?s.availableSlots?`Available Slots: ${s.availableSlots}`:"Available":i.value?"Fully Booked":""),3)]))),128))])])]),t("div",ft,[t("button",{onClick:Q,class:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-8 rounded"}," BACK "),t("button",{onClick:ye,disabled:!i.value||!b.value,class:T(["py-2 px-8 rounded text-white",!i.value||!b.value?"bg-gray-300":"bg-blue-500 hover:bg-blue-600"])}," CONFIRM ",10,wt)])])])):k("",!0)])],64))}};export{At as default};
