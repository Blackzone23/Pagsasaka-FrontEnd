import{A as u,i as Te,f as y,g as N,D as V,c as i,E as F,l as m,a as d,b as e,F as M,h as D,t as n,r as De,k as A,G as Z,u as c,w as q,J as ee,I as p,j as $e,o as l,e as x,N as te,O as se}from"./index-uLLRMIoJ.js";import{L as Re,T as je}from"./Toast-ChrbsX0y.js";import{_ as Le}from"./Market_NavBar-nT8rMuN8.js";import{B as Ae}from"./BaseLabel-BGGc0Nu1.js";import{_ as Pe}from"./BaseSearchField-CDsmXPxr.js";import{_ as Be}from"./Footer-BRLUwhOF.js";import{c as z,r as oe,u as Ne,B as ae}from"./BaseError-CtNLVL9Y.js";import"./lodash-CL_KSIKK.js";/* empty css                                                              */const Ve={class:"p-5"},Fe={class:"flex flex-wrap gap-6"},qe={class:"w-full md:w-1/2 flex justify-center"},ze=["src"],Ee={class:"w-full md:w-1/2 mt-5"},We={class:"mt-2 text-sm md:text-base"},Ue={class:"text-lg font-semibold text-black"},Oe={class:"mt-3"},Qe={class:"text-lg"},Ye={class:"flex items-center space-x-4 mt-3"},Je={class:"flex items-center border border-gray-300 rounded-full p-1"},Ge={class:"font-bold mx-4"},He={class:"flex flex-wrap gap-3 items-center mt-4"},Ke=["onClick"],Xe=["onClick"],Ze={class:"p-4"},et={class:"h-full p-5 flex flex-col md:flex-row items-center border-2 border-gray-300 rounded-md space-y-5 md:space-y-0 md:space-x-5 w-full"},tt=["src"],st={class:"flex flex-col text-md text-gray-600 text-center md:text-left"},ot={class:"font-semibold"},at={class:"mt-3 flex flex-wrap gap-2 justify-center md:justify-start"},rt=["onClick"],lt={class:"w-full md:flex-1 grid grid-cols-2 md:grid-cols-4 gap-4 items-center text-gray-600 text-center"},nt={class:"flex flex-col items-center"},it={class:"text-xs"},dt={class:"p-4"},ct={class:"border-2 border-gray-300 p-4 rounded-md"},ut={class:"flex items-center gap-4"},mt={class:"text-lg font-semibold"},gt={class:"flex items-center gap-4"},ht=["src"],ft={class:"font-bold"},vt={class:"text-sm text-gray-500"},pt={class:"mt-2 text-gray-700"},xt={key:0,class:"mt-1 text-gray-500"},_t={class:"space-x-4"},yt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center"},bt={class:"bg-white p-6 rounded-md w-96"},wt={class:"p-4"},Ct={key:0,class:"fixed bottom-4 right-4 2xl:w-[900px] 2xs:w-[470px] 2xl:h-[85vh] 2xs:h-[65vh] bg-white rounded-lg shadow-lg flex flex-col border z-50"},kt={class:"p-4 border-b rounded-sm bg-gray-100 flex justify-between items-center"},St={class:"flex flex-1 overflow-hidden"},Mt={class:"w-1/3 bg-white border-r border-gray-300 p-4 flex flex-col"},It={class:"flex"},Tt={class:"mt-3 flex-1 overflow-auto"},Dt=["onClick"],$t=["src"],Rt={class:"flex-1"},jt={class:"font-semibold"},Lt={class:"text-xs text-gray-500 truncate"},At={key:0,class:"text-xs bg-red-500 text-white px-2 py-1 rounded-full"},Pt=["onClick"],Bt={key:1,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50"},Nt={class:"bg-white p-6 rounded shadow-lg w-96"},Vt={class:"flex justify-around mt-4"},Ft={class:"w-full flex flex-col"},qt={key:0,class:"flex-1 flex items-center justify-center text-gray-400"},zt={key:1,class:"flex flex-col h-full"},Et={class:"p-4 border-b flex justify-between items-center bg-gray-100"},Wt={class:"text-lg font-semibold"},Ut={class:"flex-1 bg-gray-50 p-4 overflow-auto space-y-4 2xl:text-sm 2xs:text-sm max-h-[400px]"},Ot=["src"],Qt={class:"text-xs"},Yt=["src"],Jt={class:"p-4 border-t bg-gray-50 flex items-center"},rs={__name:"Market_Page1",setup(Gt){const a=Te(),E=$e(),re=u(()=>a.state.showLoading.state),b=u(()=>a.state.Consumer.productItem.productItemInfo),W=u(()=>a.state.Consumer.productRatings),U=u(()=>a.state.Consumer.conversation.data),O=u(()=>a.state.Consumer.message.data);u(()=>a.state.Consumer.farmerInfo.data);const v=u(()=>{var o,t;return((t=(o=a.state.userData.data)==null?void 0:o.user)==null?void 0:t.id)||null}),le=u(()=>{var o,t;return((t=(o=a.state.userData.data)==null?void 0:o.user)==null?void 0:t.avatar)||I.value}),I=y("path/to/default/avatar.png"),$=y(!1),R=u(()=>{var t;const o=sessionStorage.getItem("ItemInfo");return((t=W.value)==null?void 0:t[o])||null});function ne(){const o=sessionStorage.getItem("ItemInfo");a.dispatch("Consumer/getFarmerInfoList",o)}N(()=>{ne()});async function ie(o){sessionStorage.setItem("ItemInfo",o),E.push({name:"Viewshop"})}function de(){const o=sessionStorage.getItem("ItemInfo");a.dispatch("Consumer/getItemListInfo",o)}async function Q(o=!1){var r;const t=sessionStorage.getItem("ItemInfo");t&&(o||!((r=W.value)!=null&&r[t]))&&await a.dispatch("Consumer/getProductRatings",t)}function ce(o){return new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}N(()=>{de(),Q()});const w=y(1),ue=()=>{w.value++},me=()=>{w.value>1&&w.value--},ge=async o=>{try{await a.dispatch("Consumer/getBuyNow",{id:o,quantity:w.value});const t=a.state.Consumer.cartItem.data.find(r=>r.id===o);t&&(t.selected=!0)}catch(t){console.error("Error adding to checkout:",t)}},he=async o=>{try{await a.dispatch("Consumer/getBuyNow",{id:o,quantity:w.value});const t=a.state.Consumer.cartItem.data.find(r=>r.id===o);t&&(t.selected=!0),E.push("/cart")}catch(t){console.error("Error adding to checkout:",t)}},fe=V({name:"Janromil Dela Cruz",lastActive:new Date(Date.now()-5*60*1e3)});u(()=>{const o=new Date,t=new Date(fe.lastActive),r=o-t,h=Math.floor(r/(1e3*60)),S=Math.floor(r/(1e3*60*60));return h<1?"Active now":h<60?`${h} minutes ago`:S<24?`${S} hours ago`:`${Math.floor(S/24)} days ago`});const j=y(!1),g=y(null),C=V({message:""}),ve=()=>{g.value=null},pe=()=>{j.value=!0},xe=()=>{j.value=!1},_e=o=>{console.log("Selected chat ID:",o);const t=U.value.find(r=>r.id===o);g.value=t,a.dispatch("Consumer/getMessages",o)},ye=async()=>{if(!C.message.trim()||!g.value)return;const o={id:g.value.id,message:C.message};try{await a.dispatch("Consumer/sendMessage",o),await a.dispatch("Consumer/getMessages",g.value.id),C.message=""}catch(t){console.error("Failed to send message:",t)}},be=()=>{var t;if(j.value=!0,console.log("productItemListinfo:",b.value),!b.value||b.value.length===0){console.error("productItemListinfo is empty or undefined"),setTimeout(()=>{a.commit("showToast",{showToast:!0,toastMessage:"Product data not loaded",toastType:"error"},{root:!0})},te),setTimeout(()=>{a.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"},{root:!0})},se);return}const o=(t=b.value[0])==null?void 0:t.account_id;if(!o){console.error("Seller ID not found in productItemListinfo[0].account_id"),setTimeout(()=>{a.commit("showToast",{showToast:!0,toastMessage:"Seller ID not found",toastType:"error"},{root:!0})},te),setTimeout(()=>{a.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"},{root:!0})},se);return}console.log("Starting chat with user2_id:",o),a.dispatch("Consumer/startChatWithShop",{user2_id:o}).then(r=>{if(!r){console.error("No response received from startChatWithShop");return}console.log("startChatWithShop response:",r);const h={id:r.id,chat_partner_name:r.chat_partner_name,chat_partner_avatar:r.chat_partner_avatar,message:r.message||"",unread_messages_count:r.unread_messages_count||0};g.value=h,C.conversation_id=h.id,a.dispatch("Consumer/getMessages",h.id)}).catch(r=>{console.error("Failed to start chat:",r)})};function Y(){a.dispatch("Consumer/getConversation")}N(()=>{Y()});const P=y(!1),we=()=>{_.rating=0,_.comment="",P.value=!0},J=()=>{P.value=!1},_=V({rating:0,comment:""}),Ce=u(()=>({rating:{required:z.withMessage("Please select a rating",oe),minValue:z.withMessage("Rating must be at least 1 star",o=>o>=1)},comment:{required:z.withMessage("Comment is required",oe)}})),T=Ne(Ce,_);async function ke(){if(await T.value.$validate())try{await a.dispatch("Consumer/createComment",{..._,product_id:sessionStorage.getItem("ItemInfo")}),J(),await Q(!0)}catch(t){console.error("Failed to create comment:",t)}}const L=y(!1),k=y(null),Se=(o,t)=>{t.stopPropagation(),L.value=!0,k.value=o},Me=o=>{o.stopPropagation(),L.value=!1,k.value=null},Ie=async()=>{var o;if(k.value)try{await a.dispatch("Consumer/deleteConversation",k.value),L.value=!1,k.value=null,Y(),((o=g.value)==null?void 0:o.id)===k.value&&(g.value=null,O.value=[])}catch(t){console.error("Failed to delete conversation:",t)}};return(o,t)=>{var h,S,B,G,H;const r=De("n-rate");return l(),i(M,null,[re.value?(l(),F(Re,{key:0,class:"loading"})):m("",!0),d(je),e("div",null,[d(Le),e("div",Ve,[e("div",Fe,[(l(!0),i(M,null,D(b.value,s=>(l(),i("div",{key:s.id,class:"flex flex-col md:flex-row w-full border-2 border-gray-300 p-5 rounded-md"},[e("div",qe,[e("img",{src:s.product_img[0],alt:"Product Image",class:"rounded-lg shadow-lg w-full max-w-md h-auto md:h-[400px]"},null,8,ze)]),e("div",Ee,[d(Ae,{class:"text-2xl md:text-4xl font-bold"},{default:q(()=>[x(n(s.product_name),1)]),_:2},1024),e("div",We,[e("p",Ue,"₱"+n(s.price),1),t[11]||(t[11]=e("p",{class:"mt-2"},"Free & Easy Returns Enjoy Free Return",-1)),e("div",Oe,[t[7]||(t[7]=e("h1",{class:"font-bold text-lg"},"Shipping",-1)),e("div",Qe,[e("p",null,[t[5]||(t[5]=e("span",{class:"font-semibold"},"Stock:",-1)),x(" "+n(s.stocks),1)]),e("p",null,[t[6]||(t[6]=e("span",{class:"font-semibold"},"Unit:",-1)),x(" "+n(s.unit),1)])])]),e("div",Ye,[t[8]||(t[8]=e("h2",{class:"font-bold text-lg"},"Quantity:",-1)),e("div",Je,[e("button",{onClick:me},[d(c(p),{icon:"zondicons:minus-solid",width:"20",height:"20",style:{color:"#608C54"}})]),e("span",Ge,n(w.value),1),e("button",{onClick:ue},[d(c(p),{icon:"gridicons:add",width:"24",height:"24",style:{color:"#608C54"}})])])]),e("div",He,[e("button",{onClick:f=>ge(s.id),class:"bg-[#608C54] text-white font-bold px-4 py-2 hover:bg-[#4e7343] rounded flex items-center gap-2"},[d(c(p),{icon:"lineicons:cart-2",width:"24",height:"24",style:{color:"#fff"}}),t[9]||(t[9]=x(" Add to Cart "))],8,Ke),e("button",{onClick:f=>he(s.id),class:"bg-[#608C54] text-white font-bold py-2 px-5 rounded hover:bg-[#4e7343] flex items-center gap-2"},[d(c(p),{icon:"icon-park-twotone:buy",width:"24",height:"24",style:{color:"#fff"}}),t[10]||(t[10]=x(" Buy Now "))],8,Xe)])])])]))),128))])]),e("div",Ze,[e("div",et,[(l(!0),i(M,null,D(b.value,s=>(l(),i("div",{key:s.id,class:"flex flex-col md:flex-row items-center space-x-3 w-full md:w-auto"},[e("img",{src:s.seller_avatar,alt:"Placeholder Image",class:"w-16 h-16 rounded-full border border-gray-500"},null,8,tt),e("div",st,[e("span",ot,n(s.seller_name),1),e("div",at,[e("button",{onClick:be,class:"flex items-center gap-1 px-4 py-2 bg-[#608C54] text-white text-sm font-medium rounded-lg hover:bg-green-700 transition","aria-label":"Start chat with seller"},[d(c(p),{icon:"mdi:chat",width:"20",height:"20",style:{color:"white"}}),t[12]||(t[12]=x(" Chat Now "))]),e("button",{onClick:f=>ie(s.id),class:"flex items-center gap-1 px-4 py-2 bg-white text-sm font-medium rounded-lg hover:bg-gray-300 transition border border-gray-300"},[d(c(p),{icon:"bx:store",width:"20",height:"20",style:{color:"black"}}),t[13]||(t[13]=x(" View Shop "))],8,rt)])]),t[15]||(t[15]=e("div",{class:"hidden md:block border-l border-gray-300 h-20"},null,-1)),e("div",lt,[e("div",nt,[t[14]||(t[14]=e("h1",{class:"text-md font-semibold"},"Total Products",-1)),e("span",it,n(s.total_products),1)])])]))),128))])]),t[20]||(t[20]=e("div",{class:"p-5"},[e("div",{class:"border-2 p-5 border-gray-300 rounded-md"},[e("h1",{class:"text-lg font-semibold"},"Product Description"),e("p",{class:"text-md leading-relaxed"}," Our Salad Pack is packed with fiber and essential nutrients—quick and easy to prepare. Whether you’re a busy professional, a fitness enthusiast, or just someone looking to make healthy eating more convenient, this pack is designed to simplify your life without compromising nutrition. ")])],-1)),e("div",dt,[e("div",ct,[e("div",ut,[e("h2",mt,"Total Reviews: "+n(((h=R.value)==null?void 0:h.total_ratings)||0),1),d(r,{"allow-half":"",readonly:"",value:((S=R.value)==null?void 0:S.average_rating)||0,size:"small"},null,8,["value"])]),e("div",{class:A([$.value?"max-h-96 overflow-y-auto":"","mt-4"])},[(l(!0),i(M,null,D(((G=(B=R.value)==null?void 0:B.ratings)==null?void 0:G.data)||[],s=>{var f,K,X;return l(),i("div",{key:s.id,class:"p-4 border-2 border-gray-300 rounded-md mb-2"},[e("div",gt,[e("img",{src:((f=s.account)==null?void 0:f.avatar)||I.value,alt:"Reviewer Avatar",class:"w-12 h-12 rounded-full object-cover"},null,8,ht),e("div",null,[d(r,{"allow-half":"",readonly:"",value:s.rating,size:"small"},null,8,["value"]),e("h3",ft,n((K=s.account)==null?void 0:K.first_name)+" "+n((X=s.account)==null?void 0:X.last_name),1),e("p",vt,n(ce(s.created_at)),1)])]),e("p",pt,n(s.comment),1),s.seller_response?(l(),i("p",xt,"Seller: "+n(s.seller_response),1)):m("",!0)])}),128))],2),e("div",_t,[((H=R.value)==null?void 0:H.total_ratings)>0?(l(),i("button",{key:0,onClick:t[0]||(t[0]=s=>$.value=!$.value),class:"bg-[#608C54] text-white py-2 px-4 rounded shadow hover:bg-green-700 transition mt-2"},n($.value?"Collapse Reviews":"See More Reviews"),1)):m("",!0),e("button",{onClick:we,class:"bg-gray-700 text-white py-2 px-4 rounded shadow hover:bg-gray-600 transition mt-4"}," Add New Comment ")])]),P.value?(l(),i("div",yt,[e("div",bt,[t[16]||(t[16]=e("h2",{class:"text-lg font-semibold mb-4"},"Add Your Review",-1)),d(r,{value:_.rating,"onUpdate:value":t[1]||(t[1]=s=>_.rating=s),"allow-half":"",size:"large",class:"mb-4"},null,8,["value"]),c(T).rating.$error?(l(),F(ae,{key:0},{default:q(()=>[x(n(c(T).rating.$errors[0].$message),1)]),_:1})):m("",!0),Z(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>_.comment=s),placeholder:"Write your comment...",rows:"4",class:"w-full border-2 border-gray-300 p-2 rounded-md"},null,512),[[ee,_.comment]]),c(T).comment.$error?(l(),F(ae,{key:1},{default:q(()=>[x(n(c(T).comment.$errors[0].$message),1)]),_:1})):m("",!0),e("div",{class:"mt-4 flex gap-2"},[e("button",{onClick:ke,class:"bg-green-800 text-white py-2 px-4 rounded shadow hover:bg-green-600 transition"}," Submit "),e("button",{onClick:J,class:"bg-red-800 text-white py-2 px-4 rounded shadow hover:bg-red-600 transition"}," Cancel ")])])])):m("",!0)]),e("div",wt,[e("button",{onClick:pe,class:"hidden md:flex bg-yellow-100 border-2 border-gray-300 rounded-full p-3 fixed bottom-4 right-4 shadow-md hover:bg-yellow-300 items-center justify-center"},[d(c(p),{icon:"tabler:message",width:"28",height:"28",style:{color:"#608C54"}})])]),j.value?(l(),i("div",Ct,[e("div",kt,[t[17]||(t[17]=e("span",{class:"text-xl font-bold text-green-600"},"Chat",-1)),e("button",{onClick:xe,class:"text-gray-600 text-lg"},[d(c(p),{icon:"icon-park-solid:close-one",width:"20",height:"20"})])]),e("div",St,[e("div",Mt,[e("div",It,[d(Pe,{placeholder:"Search...",class:"2xl:w-[270px] 2xs:w-[137px]"})]),e("div",Tt,[(l(!0),i(M,null,D(U.value,s=>(l(),i("div",{key:s.id,class:"flex items-center p-3 border-b cursor-pointer hover:bg-gray-100 transition duration-200",onClick:f=>_e(s.id)},[e("img",{src:s.chat_partner_avatar||I.value,class:"w-12 h-12 rounded-full border mr-3",alt:"Avatar"},null,8,$t),e("div",Rt,[e("span",jt,n(s.chat_partner_name),1),e("p",Lt,n(s.message||"No messages"),1)]),s.unread_messages_count?(l(),i("span",At,n(s.unread_messages_count),1)):m("",!0),e("button",{onClick:f=>Se(s.id,f)},[d(c(p),{icon:"mdi-light:delete",width:"20",height:"20",style:{color:"#ad1414"}})],8,Pt),L.value?(l(),i("div",Bt,[e("div",Nt,[t[18]||(t[18]=e("h3",{class:"text-xl font-semibold text-center"},"Are you sure you want to delete this conversation?",-1)),e("div",Vt,[e("button",{onClick:Ie,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"},"Yes, Delete"),e("button",{onClick:t[3]||(t[3]=f=>Me(f)),class:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400"},"Cancel")])])])):m("",!0)],8,Dt))),128))])]),e("div",Ft,[g.value?(l(),i("div",zt,[e("div",Et,[e("h2",Wt,n(g.value.chat_partner_name),1),e("button",{onClick:ve,class:"text-gray-500"},"Close")]),e("div",Ut,[(l(!0),i(M,null,D(O.value,s=>(l(),i("div",{key:s.id,class:A(["flex items-start space-x-3",{"justify-end":s.sender.id===v.value,"justify-start":s.sender.id!==v.value}])},[s.sender.id!==v.value?(l(),i("img",{key:0,src:s.sender.avatar||I.value,class:"w-8 h-8 rounded-full"},null,8,Ot)):m("",!0),e("div",{class:A(["p-3 rounded-lg shadow-md w-auto max-w-xs",{"bg-green-500 text-white":s.sender.id===v.value,"bg-gray-200 text-black":s.sender.id!==v.value}])},[e("p",{class:A(["text-sm font-bold",{"text-white":s.sender.id===v.value,"text-green-600":s.sender.id!==v.value}])},n(s.sender.id===v.value?"You":s.sender.first_name+" "+s.sender.last_name),3),e("p",Qt,n(s.message),1)],2),s.sender.id===v.value?(l(),i("img",{key:1,src:le.value||I.value,class:"w-8 h-8 rounded-full"},null,8,Yt)):m("",!0)],2))),128))]),e("div",Jt,[Z(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>C.message=s),type:"text",placeholder:"Type a message...",class:"flex-1 p-2 border rounded-md text-sm"},null,512),[[ee,C.message]]),e("button",{onClick:ye,class:"ml-2 bg-green-500 text-white px-4 py-2 rounded-md transition duration-200 hover:bg-green-700"}," Send ")])])):(l(),i("div",qt,t[19]||(t[19]=[e("p",{class:"text-xl"},"Welcome to Pagsasaka Chat",-1)])))])])])):m("",!0)]),d(Be)],64)}}};export{rs as default};
