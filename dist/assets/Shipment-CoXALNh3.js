import"./lodash--ewKp5e3.js";import{A as g,i as Y,f as p,g as b,D as J,c as n,b as t,l as h,a as L,u as O,I,k as f,F as x,h as m,t as l,j as K,o as r,d as X}from"./index-CpL9wR7w.js";import{E as Z}from"./jspdf.es.min-CwrK9Wzg.js";import tt from"./html2canvas.esm-CBrSDip1.js";const et={class:"flex min-h-screen bg-gray-100"},st={class:"flex-1 flex flex-col"},ot={class:"bg-[#285a19] shadow p-4 flex justify-between items-center text-white"},at={class:"flex items-center space-x-4"},lt={class:"relative inline-block text-left"},nt={class:"flex items-center space-x-2"},rt=["src"],dt={key:0,class:"absolute right-0 z-50 mt-2 w-48 bg-white rounded shadow-lg"},it={class:"p-5"},ct={key:0},ut={class:"mb-4 text-sm flex flex-wrap gap-2"},pt={key:0,class:"table-auto w-full border-collapse border border-gray-300"},gt=["onClick"],ht={class:"px-4 py-2"},xt={class:"px-4 py-2"},mt={class:"px-4 py-2"},bt={class:"px-4 py-2"},vt={class:"px-4 py-2"},ft={key:0,class:"table-auto w-full border-collapse border border-gray-300"},yt=["onClick"],_t={class:"px-4 py-2"},wt={class:"px-4 py-2"},kt={class:"px-4 py-2"},Ct={class:"px-4 py-2"},St={class:"px-4 py-2"},Lt={class:"flex-1 text-center"},Ot={class:"text-lg font-bold"},It={class:"text-sm"},Pt={key:0},Ut={class:"relative flex items-center justify-center mt-6"},Dt={class:"flex space-x-10 md:space-x-[60px] z-10"},jt={class:"flex space-x-4 md:space-x-[47px] justify-center items-center text-center mt-2 text-xs md:text-sm"},Tt={class:"mt-8"},Mt={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},Rt={class:"bg-white w-[700px] p-4 rounded-lg relative packing-slip-modal-content"},Nt={class:"mt-10 w-full"},Ft={class:"text-center mb-2"},Wt={class:"font-semibold"},Vt={class:"text-xs"},$t={class:"grid grid-cols-2 gap-2 border-y py-2 mb-2"},zt={class:"font-bold"},Bt=["innerHTML"],Ht={class:"font-bold"},At=["innerHTML"],Et={class:"grid grid-cols-4 gap-2 items-start border-b pb-2 mb-2"},qt={class:"col-span-1 flex flex-col items-center"},Gt={class:"text-xs text-gray-600"},Qt={class:"col-span-3"},Yt={class:"w-full text-left text-sm"},Jt={class:"py-1"},Kt={class:"text-xs text-gray-600"},Xt={class:"py-1"},Zt={class:"py-1"},te={class:"text-center font-semibold text-sm mt-4"},ee={class:"flex justify-center mt-4"},se=["disabled"],oe={key:0,class:"flex justify-center items-center mt-6 md:mt-0"},ae=["src"],ce={__name:"Shipment",setup(le){const d=Y(),P=K(),U=g(()=>d.state.User.order.data),D=g(()=>d.state.User.cancel.data);g(()=>d.state.User.refund.data);const j=g(()=>d.state.User.print.data),y=g(()=>d.state.User.order.image),a=p(null),u=p("orders"),T=g(()=>{var o;return((o=d.state.userData.data)==null?void 0:o.user)||{}});function M(){d.dispatch("User/getOrderList")}b(()=>{M()});function R(){d.dispatch("User/getImage")}b(()=>{R()});const N=o=>{a.value=o,d.dispatch("User/getImage",o.id)},_=[{id:"Order placed",label:"Order placed",icon:"hugeicons:package-process"},{id:"Waiting for courier",label:"Waiting for courier",icon:"ic:outline-local-shipping"},{id:"In transit",label:"In transit",icon:"la:shipping-fast"},{id:"Order delivered",label:"Order delivered",icon:"hugeicons:package-receive"}],F=o=>{if(!a.value)return"bg-gray-300";const s=_.map(c=>c.id.toLowerCase()),i=s.indexOf(a.value.status.toLowerCase()),e=s.indexOf(o.toLowerCase());return e<i?"bg-green-500":e===i?"bg-[#608C54]":"bg-gray-300"},w=J({id:"",status:""});async function W(){if(!a.value)return;const o=["Order placed","Waiting for courier","In transit","Order delivered"],s=o.indexOf(a.value.status);if(s===-1||s===o.length-1)return;if(o[s]==="Waiting for courier"&&!C){console.warn("Slip not downloaded yet.");return}const i=o[s+1];w.id=a.value.id,w.status=i,await d.dispatch("User/updateStatus",w).then(e=>{e.isSuccess&&(a.value.status=i)}).catch(e=>{console.error("Error updating status:",e)})}function V(){d.dispatch("User/getCancelList")}b(()=>{V()});const $=o=>{a.value=o};p(!1),p(null);function z(){d.dispatch("User/getRefundList")}b(()=>{z()});function B(o){d.dispatch("User/getPrintList",o)}b(()=>{B()});const k=p(!1),C=p(!1),H=()=>{k.value=!0};function A(){k.value=!1}p(!1);const E=()=>{const o=document.querySelector(".packing-slip-modal-content");if(!o){console.error("Modal content not found");return}tt(o).then(s=>{const i=s.toDataURL("image/png"),e=new Z,v=210-40,Q=s.height*v/s.width;e.addImage(i,"PNG",20,20,v,Q),e.save("packing-slip.pdf"),C.value=!0,A()})},S=p(!1),q=()=>{S.value=!S.value},G=async()=>{try{(await d.dispatch("logout")).isSuccess&&P.push({name:"Login"})}catch(o){console.error("Logout error:",o)}};return(o,s)=>{var i;return r(),n("div",et,[t("div",st,[t("header",ot,[s[5]||(s[5]=t("h1",{class:"text-lg sm:text-xl 2xl:ml-0 md:ml-10 2xs:ml-10 font-bold"},"Shipment",-1)),t("div",at,[t("div",lt,[t("div",nt,[t("img",{src:T.value.avatar,alt:"Profile",class:"w-10 h-10 rounded-full object-cover shadow-md"},null,8,rt),L(O(I),{icon:"uil:setting",width:"24",height:"24",class:"cursor-pointer text-white",onClick:q})]),S.value?(r(),n("div",dt,[s[4]||(s[4]=t("a",{href:"/seller-profile",class:"block px-4 py-2 text-sm text-black hover:bg-gray-100"}," Account Info ",-1)),t("button",{onClick:G,class:"block w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100"}," Logout ")])):h("",!0)])])]),t("div",it,[a.value?(r(),n("div",{key:1,class:f(["p-5 border-2 rounded-md mt-2 text-center flex flex-col md:flex-row items-center md:items-start",{"border-blue-300":a.value.status==="Order","border-red-300 text-red-600":a.value.status==="Cancelled","border-yellow-300 text-yellow-600":a.value.status==="Refund","border-[#608C54]":a.value.status!=="Order"&&a.value.status!=="Cancelled"&&a.value.status!=="Refund"}])},[t("div",Lt,[t("h1",Ot,l(a.value.status)+" Shipment",1),t("p",It,l(a.value.status==="Order"?"This shipment is currently being processed.":a.value.status==="Cancelled"?"This shipment has been cancelled. Contact customer support for assistance.":a.value.status==="Refund"?"You should receive the refund in your account shortly.":"Tracking Details"),1),a.value.status!=="Cancelled"&&a.value.status!=="Refund"?(r(),n("div",Pt,[t("div",Ut,[s[9]||(s[9]=t("div",{class:"absolute w-3/4 md:w-[430px] h-1 bg-[#608C54] top-1/2 z-0"},null,-1)),t("div",Dt,[(r(),n(x,null,m(_,e=>t("div",{key:e.id,class:f(["w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center",F(e.id)])},[L(O(I),{icon:e.icon,class:"text-white w-6 h-6 md:w-8 md:h-8"},null,8,["icon"])],2)),64))])]),t("div",jt,[(r(),n(x,null,m(_,e=>t("span",{key:e.id},l(e.label),1)),64))]),t("div",Tt,[t("button",{onClick:H,class:"py-2 px-3 font-semibold rounded-lg shadow-md text-white bg-blue-700 hover:bg-red-600 border-2 text-sm border-gray-300"}," Print Packing Slip "),k.value?(r(),n("div",Mt,[t("div",Rt,[t("div",Nt,[(r(!0),n(x,null,m(j.value,e=>(r(),n("div",{key:e.id,class:"bg-white p- border border-gray-400 rounded-lg text-sm font-sans"},[s[14]||(s[14]=X('<div class="flex justify-between items-center border-b pb-2 mb-2"><div class="flex items-center gap-2"><div><h1 class="text-lg font-bold text-green-700">Pagsasaka</h1><p class="text-xs text-gray-600">Farmers &amp; Consumer</p></div></div><div class="text-right"><p class="font-semibold text-lg">Logistics Logo</p></div></div>',1)),t("div",Ft,[t("p",Wt,"Product Name: "+l(e.orderId),1),t("p",Vt,l(e.orderId),1)]),t("div",$t,[t("div",null,[s[10]||(s[10]=t("p",{class:"font-semibold border-b pb-1"},"Buyer",-1)),t("p",zt,l(e.name),1),t("p",{innerHTML:e.address},null,8,Bt)]),t("div",null,[s[11]||(s[11]=t("p",{class:"font-semibold border-b pb-1"},"Seller",-1)),t("p",Ht,l(e.name),1),t("p",{innerHTML:e.address},null,8,At)])]),t("div",Et,[t("div",qt,[t("p",Gt,l(e.orderId),1)]),t("div",Qt,[t("table",Yt,[s[13]||(s[13]=t("thead",null,[t("tr",{class:"border-b"},[t("th",{class:"py-1"},"Product (Qty)"),t("th",{class:"py-1"},"Price"),t("th",{class:"py-1"},"Total")])],-1)),t("tbody",null,[(r(!0),n(x,null,m(o.order.items,(c,v)=>(r(),n("tr",{key:v},[t("td",Jt,[t("strong",null,l(c.name),1),s[12]||(s[12]=t("br",null,null,-1)),t("span",Kt,"Variants: "+l(c.variant),1)]),t("td",Xt,"₱"+l(c.price.toFixed(2)),1),t("td",Zt,"₱"+l((c.price*c.quantity).toFixed(2)),1)]))),128))])])])]),t("div",te," Order ID: "+l(o.order.orderId),1)]))),128))]),t("div",{class:"mt-4 text-center"},[t("button",{onClick:E,class:"py-2 px-4 rounded-md bg-green-700 text-white"}," Download Packing Slip as PDF ")])])])):h("",!0)]),t("div",ee,[t("button",{onClick:s[2]||(s[2]=e=>W()),disabled:((i=a.value)==null?void 0:i.status)==="Order placed"&&!C.value,class:"px-12 py-2 text-sm font-semibold rounded-lg shadow-md transition text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},"Approve",8,se)])])):h("",!0),t("button",{class:"mt-4 px-4 py-2 bg-gray-300 font-semibold rounded-lg shadow-md text-sm",onClick:s[3]||(s[3]=e=>a.value=null)}," Back to Shipments ")]),y.value&&y.value.delivery_proof?(r(),n("div",oe,[t("img",{src:y.value.delivery_proof,alt:"Shipment Image",class:"border border-gray-500 w-[280px] h-[300px] md:w-[350px] md:h-[400px] rounded-lg shadow-md object-cover"},null,8,ae)])):h("",!0)],2)):(r(),n("div",ct,[t("div",ut,[t("button",{class:f(["px-4 py-2 rounded transition",{"bg-blue-500 text-white":u.value==="orders","bg-gray-200":u.value!=="orders"}]),onClick:s[0]||(s[0]=e=>u.value="orders")}," My Orders",2),t("button",{class:f(["px-4 py-2 rounded transition",{"bg-red-500 text-white":u.value==="cancellations","bg-gray-200":u.value!=="cancellations"}]),onClick:s[1]||(s[1]=e=>u.value="cancellations")}," Cancellations",2)]),t("div",null,[u.value==="orders"?(r(),n("table",pt,[s[6]||(s[6]=t("thead",null,[t("tr",{class:"bg-gray-300"},[t("th",{class:"px-4 py-2"},"Name"),t("th",{class:"px-4 py-2"},"Created"),t("th",{class:"px-4 py-2"},"Last Updated"),t("th",{class:"px-4 py-2"},"Ship To"),t("th",{class:"px-4 py-2"},"Status")])],-1)),t("tbody",null,[(r(!0),n(x,null,m(U.value,e=>(r(),n("tr",{key:e.id,class:"even:bg-gray-50 hover:bg-gray-200 text-center text-sm cursor-pointer",onClick:c=>N(e)},[t("td",ht,l(e.product_name),1),t("td",xt,l(e.created_at),1),t("td",mt,l(e.updated_at),1),t("td",bt,l(e.ship_to),1),t("td",vt,l(e.status),1)],8,gt))),128))])])):h("",!0)]),t("div",null,[u.value==="cancellations"?(r(),n("table",ft,[s[7]||(s[7]=t("thead",null,[t("tr",{class:"bg-gray-300"},[t("th",{class:"px-4 py-2"},"Name"),t("th",{class:"px-4 py-2"},"Created"),t("th",{class:"px-4 py-2"},"Last Updated"),t("th",{class:"px-4 py-2"},"Ship To"),t("th",{class:"px-4 py-2"},"Status")])],-1)),t("tbody",null,[(r(!0),n(x,null,m(D.value,e=>(r(),n("tr",{key:e.id,class:"even:bg-gray-50 hover:bg-gray-200 text-center text-sm cursor-pointer",onClick:c=>$(e)},[t("td",_t,l(e.product_name),1),t("td",wt,l(e.created_at),1),t("td",kt,l(e.updated_at),1),t("td",Ct,l(e.ship_to),1),t("td",St,l(e.status),1)],8,yt))),128))])])):h("",!0)]),s[8]||(s[8]=t("div",{class:"p-5 border-2 border-gray-300 rounded-md mt-2 text-center"},[t("h1",{class:"text-lg font-bold"},"Select a Shipment"),t("p",{class:"text-sm"},"Please select a shipment from the table to view tracking details.")],-1))]))])])])}}};export{ce as default};
