import{A as h,i as De,f as x,g as F,D as N,c as i,E as V,l as u,a as d,b as e,F as S,h as I,t as n,r as Te,k as B,G as X,u as c,w as q,H as Z,I as _,j as Ie,o as r,e as y,O as ee,P as te}from"./index-B8b6vpke.js";import{L as Re,T as $e}from"./Toast-S2wpvofn.js";import{_ as je,B as Le}from"./Market_NavBar-CuXXoisQ.js";import{B as Be}from"./BaseLabel-jrKegtSt.js";import{_ as Pe}from"./Footer-bMJDy6fk.js";import{c as z,r as se,u as Ae,B as oe}from"./BaseError-BBHvMZ_b.js";import"./lodash-BBt1jD-E.js";const Fe={class:"p-5"},Ne={class:"flex flex-wrap gap-6"},Ve={class:"w-full md:w-1/2 flex justify-center"},qe=["src"],ze={class:"w-full md:w-1/2 mt-5"},Ee={class:"mt-2 text-sm md:text-base"},We={class:"text-lg font-semibold text-black"},Ue={class:"mt-3"},Oe={class:"text-lg"},Qe={class:"flex items-center space-x-4 mt-3"},Ye={class:"flex items-center border border-gray-300 rounded-full p-1"},He={class:"font-bold mx-4"},Ge={class:"flex flex-wrap gap-3 items-center mt-4"},Je=["onClick"],Ke=["onClick"],Xe={class:"p-4"},Ze={class:"h-full p-5 flex flex-col md:flex-row items-center border-2 border-gray-300 rounded-md space-y-5 md:space-y-0 md:space-x-5 w-full"},et=["src"],tt={class:"flex flex-col text-md text-gray-600 text-center md:text-left"},st={class:"font-semibold"},ot={class:"mt-3 flex flex-wrap gap-2 justify-center md:justify-start"},at={class:"w-full md:flex-1 grid grid-cols-2 md:grid-cols-4 gap-4 items-center text-gray-600 text-center"},lt={class:"flex flex-col items-center"},rt={class:"text-xs"},nt={class:"p-4"},it={class:"border-2 border-gray-300 p-4 rounded-md"},dt={class:"flex items-center gap-4"},ct={class:"text-lg font-semibold"},ut={class:"flex items-center gap-4"},mt=["src"],gt={class:"font-bold"},ht={class:"text-sm text-gray-500"},ft={class:"mt-2 text-gray-700"},vt={key:0,class:"mt-1 text-gray-500"},pt={class:"space-x-4"},xt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center"},_t={class:"bg-white p-6 rounded-md w-96"},yt={class:"p-4"},wt={key:0,class:"fixed bottom-4 right-4 2xl:w-[900px] 2xs:w-[470px] 2xl:h-[85vh] 2xs:h-[65vh] bg-white rounded-lg shadow-lg flex flex-col border z-50"},bt={class:"p-4 border-b rounded-sm bg-gray-100 flex justify-between items-center"},Ct={class:"flex flex-1 overflow-hidden"},kt={class:"w-1/3 bg-white border-r border-gray-300 p-4 flex flex-col"},Mt={class:"flex"},St={class:"mt-3 flex-1 overflow-auto"},Dt=["onClick"],Tt=["src"],It={class:"flex-1"},Rt={class:"font-semibold"},$t={class:"text-xs text-gray-500 truncate"},jt={key:0,class:"text-xs bg-red-500 text-white px-2 py-1 rounded-full"},Lt=["onClick"],Bt={key:1,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50"},Pt={class:"bg-white p-6 rounded shadow-lg w-96"},At={class:"flex justify-around mt-4"},Ft={class:"w-full flex flex-col"},Nt={key:0,class:"flex-1 flex items-center justify-center text-gray-400"},Vt={key:1,class:"flex flex-col h-full"},qt={class:"p-4 border-b flex justify-between items-center bg-gray-100"},zt={class:"text-lg font-semibold"},Et={class:"flex-1 bg-gray-50 p-4 overflow-auto space-y-4 2xl:text-sm 2xs:text-sm max-h-[400px]"},Wt=["src"],Ut={class:"text-xs"},Ot=["src"],Qt={class:"p-4 border-t bg-gray-50 flex items-center"},ts={__name:"Market_Page1",setup(Yt){const a=De(),ae=Ie(),le=h(()=>a.state.showLoading.state),w=h(()=>a.state.Consumer.productItem.productItemInfo),E=h(()=>a.state.Consumer.productRatings),W=h(()=>a.state.Consumer.conversation.data),U=h(()=>a.state.Consumer.message.data),f=h(()=>{var o,t;return((t=(o=a.state.userData.data)==null?void 0:o.user)==null?void 0:t.id)||null}),re=h(()=>{var o,t;return((t=(o=a.state.userData.data)==null?void 0:o.user)==null?void 0:t.avatar)||D.value}),D=x("path/to/default/avatar.png"),R=x(!1),$=h(()=>{var t;const o=sessionStorage.getItem("ItemInfo");return((t=E.value)==null?void 0:t[o])||null});function ne(){const o=sessionStorage.getItem("ItemInfo");a.dispatch("Consumer/getFarmerInfoList",o)}F(()=>{ne()});function ie(){const o=sessionStorage.getItem("ItemInfo");a.dispatch("Consumer/getItemListInfo",o)}async function O(o=!1){var l;const t=sessionStorage.getItem("ItemInfo");t&&(o||!((l=E.value)!=null&&l[t]))&&await a.dispatch("Consumer/getProductRatings",t)}function de(o){return new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}F(()=>{ie(),O()});const b=x(1),ce=()=>{b.value++},ue=()=>{b.value>1&&b.value--},me=async o=>{try{await a.dispatch("Consumer/getBuyNow",{id:o,quantity:b.value});const t=a.state.Consumer.cartItem.data.find(l=>l.id===o);t&&(t.selected=!0)}catch(t){console.error("Error adding to checkout:",t)}},ge=async o=>{try{await a.dispatch("Consumer/getBuyNow",{id:o,quantity:b.value});const t=a.state.Consumer.cartItem.data.find(l=>l.id===o);t&&(t.selected=!0),ae.push("/cart")}catch(t){console.error("Error adding to checkout:",t)}},he=N({name:"Janromil Dela Cruz",lastActive:new Date(Date.now()-5*60*1e3)});h(()=>{const o=new Date,t=new Date(he.lastActive),l=o-t,g=Math.floor(l/(1e3*60)),M=Math.floor(l/(1e3*60*60));return g<1?"Active now":g<60?`${g} minutes ago`:M<24?`${M} hours ago`:`${Math.floor(M/24)} days ago`});const j=x(!1),m=x(null),C=N({message:""}),fe=()=>{m.value=null},ve=()=>{j.value=!0},pe=()=>{j.value=!1},xe=o=>{console.log("Selected chat ID:",o);const t=W.value.find(l=>l.id===o);m.value=t,a.dispatch("Consumer/getMessages",o)},_e=async()=>{if(!C.message.trim()||!m.value)return;const o={id:m.value.id,message:C.message};try{await a.dispatch("Consumer/sendMessage",o),await a.dispatch("Consumer/getMessages",m.value.id),C.message=""}catch(t){console.error("Failed to send message:",t)}},ye=()=>{var t;if(j.value=!0,console.log("productItemListinfo:",w.value),!w.value||w.value.length===0){console.error("productItemListinfo is empty or undefined"),setTimeout(()=>{a.commit("showToast",{showToast:!0,toastMessage:"Product data not loaded",toastType:"error"},{root:!0})},ee),setTimeout(()=>{a.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"},{root:!0})},te);return}const o=(t=w.value[0])==null?void 0:t.account_id;if(!o){console.error("Seller ID not found in productItemListinfo[0].account_id"),setTimeout(()=>{a.commit("showToast",{showToast:!0,toastMessage:"Seller ID not found",toastType:"error"},{root:!0})},ee),setTimeout(()=>{a.commit("showToast",{showToast:!1,toastMessage:"",toastType:"default"},{root:!0})},te);return}console.log("Starting chat with user2_id:",o),a.dispatch("Consumer/startChatWithShop",{user2_id:o}).then(l=>{if(!l){console.error("No response received from startChatWithShop");return}console.log("startChatWithShop response:",l);const g={id:l.id,chat_partner_name:l.chat_partner_name,chat_partner_avatar:l.chat_partner_avatar,message:l.message||"",unread_messages_count:l.unread_messages_count||0};m.value=g,C.conversation_id=g.id,a.dispatch("Consumer/getMessages",g.id)}).catch(l=>{console.error("Failed to start chat:",l)})};function Q(){a.dispatch("Consumer/getConversation")}F(()=>{Q()});const P=x(!1),we=()=>{p.rating=0,p.comment="",P.value=!0},Y=()=>{P.value=!1},p=N({rating:0,comment:""}),be=h(()=>({rating:{required:z.withMessage("Please select a rating",se),minValue:z.withMessage("Rating must be at least 1 star",o=>o>=1)},comment:{required:z.withMessage("Comment is required",se)}})),T=Ae(be,p);async function Ce(){if(await T.value.$validate())try{await a.dispatch("Consumer/createComment",{...p,product_id:sessionStorage.getItem("ItemInfo")}),Y(),await O(!0)}catch(t){console.error("Failed to create comment:",t)}}const L=x(!1),k=x(null),ke=(o,t)=>{t.stopPropagation(),L.value=!0,k.value=o},Me=o=>{o.stopPropagation(),L.value=!1,k.value=null},Se=async()=>{var o;if(k.value)try{await a.dispatch("Consumer/deleteConversation",k.value),L.value=!1,k.value=null,Q(),((o=m.value)==null?void 0:o.id)===k.value&&(m.value=null,U.value=[])}catch(t){console.error("Failed to delete conversation:",t)}};return(o,t)=>{var g,M,A,H,G;const l=Te("n-rate");return r(),i(S,null,[le.value?(r(),V(Re,{key:0,class:"loading"})):u("",!0),d($e),e("div",null,[d(je),e("div",Fe,[e("div",Ne,[(r(!0),i(S,null,I(w.value,s=>(r(),i("div",{key:s.id,class:"flex flex-col md:flex-row w-full border-2 border-gray-300 p-5 rounded-md"},[e("div",Ve,[e("img",{src:s.product_img[0],alt:"Product Image",class:"rounded-lg shadow-lg w-full max-w-md h-auto md:h-[400px]"},null,8,qe)]),e("div",ze,[d(Be,{class:"text-2xl md:text-4xl font-bold"},{default:q(()=>[y(n(s.product_name),1)]),_:2},1024),e("div",Ee,[e("p",We,"₱"+n(s.price),1),t[11]||(t[11]=e("p",{class:"mt-2"},"Free & Easy Returns Enjoy Free Return",-1)),e("div",Ue,[t[7]||(t[7]=e("h1",{class:"font-bold text-lg"},"Shipping",-1)),e("div",Oe,[e("p",null,[t[5]||(t[5]=e("span",{class:"font-semibold"},"Stock:",-1)),y(" "+n(s.stocks),1)]),e("p",null,[t[6]||(t[6]=e("span",{class:"font-semibold"},"Unit:",-1)),y(" "+n(s.unit),1)])])]),e("div",Qe,[t[8]||(t[8]=e("h2",{class:"font-bold text-lg"},"Quantity:",-1)),e("div",Ye,[e("button",{onClick:ue},[d(c(_),{icon:"zondicons:minus-solid",width:"20",height:"20",style:{color:"#608C54"}})]),e("span",He,n(b.value),1),e("button",{onClick:ce},[d(c(_),{icon:"gridicons:add",width:"24",height:"24",style:{color:"#608C54"}})])])]),e("div",Ge,[e("button",{onClick:v=>me(s.id),class:"bg-[#608C54] text-white font-bold px-4 py-2 hover:bg-[#4e7343] rounded flex items-center gap-2"},[d(c(_),{icon:"lineicons:cart-2",width:"24",height:"24",style:{color:"#fff"}}),t[9]||(t[9]=y(" Add to Cart "))],8,Je),e("button",{onClick:v=>ge(s.id),class:"bg-[#608C54] text-white font-bold py-2 px-5 rounded hover:bg-[#4e7343] flex items-center gap-2"},[d(c(_),{icon:"icon-park-twotone:buy",width:"24",height:"24",style:{color:"#fff"}}),t[10]||(t[10]=y(" Buy Now "))],8,Ke)])])])]))),128))])]),e("div",Xe,[e("div",Ze,[(r(!0),i(S,null,I(w.value,s=>(r(),i("div",{key:s.id,class:"flex flex-col md:flex-row items-center space-x-3 w-full md:w-auto"},[e("img",{src:s.seller_avatar,alt:"Placeholder Image",class:"w-16 h-16 rounded-full border border-gray-500"},null,8,et),e("div",tt,[e("span",st,n(s.seller_name),1),e("div",ot,[e("button",{onClick:ye,class:"flex items-center gap-1 px-4 py-2 bg-[#608C54] text-white text-sm font-medium rounded-lg hover:bg-green-700 transition","aria-label":"Start chat with seller"},[d(c(_),{icon:"mdi:chat",width:"20",height:"20",style:{color:"white"}}),t[12]||(t[12]=y(" Chat Now "))])])]),t[14]||(t[14]=e("div",{class:"hidden md:block border-l border-gray-300 h-20"},null,-1)),e("div",at,[e("div",lt,[t[13]||(t[13]=e("h1",{class:"text-md font-semibold"},"Total Products",-1)),e("span",rt,n(s.total_products),1)])])]))),128))])]),t[19]||(t[19]=e("div",{class:"p-5"},[e("div",{class:"border-2 p-5 border-gray-300 rounded-md"},[e("h1",{class:"text-lg font-semibold"},"Product Description"),e("p",{class:"text-md leading-relaxed"}," Our Salad Pack is packed with fiber and essential nutrients—quick and easy to prepare. Whether you’re a busy professional, a fitness enthusiast, or just someone looking to make healthy eating more convenient, this pack is designed to simplify your life without compromising nutrition. ")])],-1)),e("div",nt,[e("div",it,[e("div",dt,[e("h2",ct,"Total Reviews: "+n(((g=$.value)==null?void 0:g.total_ratings)||0),1),d(l,{"allow-half":"",readonly:"",value:((M=$.value)==null?void 0:M.average_rating)||0,size:"small"},null,8,["value"])]),e("div",{class:B([R.value?"max-h-96 overflow-y-auto":"","mt-4"])},[(r(!0),i(S,null,I(((H=(A=$.value)==null?void 0:A.ratings)==null?void 0:H.data)||[],s=>{var v,J,K;return r(),i("div",{key:s.id,class:"p-4 border-2 border-gray-300 rounded-md mb-2"},[e("div",ut,[e("img",{src:((v=s.account)==null?void 0:v.avatar)||D.value,alt:"Reviewer Avatar",class:"w-12 h-12 rounded-full object-cover"},null,8,mt),e("div",null,[d(l,{"allow-half":"",readonly:"",value:s.rating,size:"small"},null,8,["value"]),e("h3",gt,n((J=s.account)==null?void 0:J.first_name)+" "+n((K=s.account)==null?void 0:K.last_name),1),e("p",ht,n(de(s.created_at)),1)])]),e("p",ft,n(s.comment),1),s.seller_response?(r(),i("p",vt,"Seller: "+n(s.seller_response),1)):u("",!0)])}),128))],2),e("div",pt,[((G=$.value)==null?void 0:G.total_ratings)>0?(r(),i("button",{key:0,onClick:t[0]||(t[0]=s=>R.value=!R.value),class:"bg-[#608C54] text-white py-2 px-4 rounded shadow hover:bg-green-700 transition mt-2"},n(R.value?"Collapse Reviews":"See More Reviews"),1)):u("",!0),e("button",{onClick:we,class:"bg-gray-700 text-white py-2 px-4 rounded shadow hover:bg-gray-600 transition mt-4"}," Add New Comment ")])]),P.value?(r(),i("div",xt,[e("div",_t,[t[15]||(t[15]=e("h2",{class:"text-lg font-semibold mb-4"},"Add Your Review",-1)),d(l,{value:p.rating,"onUpdate:value":t[1]||(t[1]=s=>p.rating=s),"allow-half":"",size:"large",class:"mb-4"},null,8,["value"]),c(T).rating.$error?(r(),V(oe,{key:0},{default:q(()=>[y(n(c(T).rating.$errors[0].$message),1)]),_:1})):u("",!0),X(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>p.comment=s),placeholder:"Write your comment...",rows:"4",class:"w-full border-2 border-gray-300 p-2 rounded-md"},null,512),[[Z,p.comment]]),c(T).comment.$error?(r(),V(oe,{key:1},{default:q(()=>[y(n(c(T).comment.$errors[0].$message),1)]),_:1})):u("",!0),e("div",{class:"mt-4 flex gap-2"},[e("button",{onClick:Ce,class:"bg-green-800 text-white py-2 px-4 rounded shadow hover:bg-green-600 transition"}," Submit "),e("button",{onClick:Y,class:"bg-red-800 text-white py-2 px-4 rounded shadow hover:bg-red-600 transition"}," Cancel ")])])])):u("",!0)]),e("div",yt,[e("button",{onClick:ve,class:"hidden md:flex bg-yellow-100 border-2 border-gray-300 rounded-full p-3 fixed bottom-4 right-4 shadow-md hover:bg-yellow-300 items-center justify-center"},[d(c(_),{icon:"tabler:message",width:"28",height:"28",style:{color:"#608C54"}})])]),j.value?(r(),i("div",wt,[e("div",bt,[t[16]||(t[16]=e("span",{class:"text-xl font-bold text-green-600"},"Chat",-1)),e("button",{onClick:pe,class:"text-gray-600 text-lg"},[d(c(_),{icon:"icon-park-solid:close-one",width:"20",height:"20"})])]),e("div",Ct,[e("div",kt,[e("div",Mt,[d(Le,{placeholder:"Search...",class:"2xl:w-[270px] 2xs:w-[137px]"})]),e("div",St,[(r(!0),i(S,null,I(W.value,s=>(r(),i("div",{key:s.id,class:"flex items-center p-3 border-b cursor-pointer hover:bg-gray-100 transition duration-200",onClick:v=>xe(s.id)},[e("img",{src:s.chat_partner_avatar||D.value,class:"w-12 h-12 rounded-full border mr-3",alt:"Avatar"},null,8,Tt),e("div",It,[e("span",Rt,n(s.chat_partner_name),1),e("p",$t,n(s.message||"No messages"),1)]),s.unread_messages_count?(r(),i("span",jt,n(s.unread_messages_count),1)):u("",!0),e("button",{onClick:v=>ke(s.id,v)},[d(c(_),{icon:"mdi-light:delete",width:"20",height:"20",style:{color:"#ad1414"}})],8,Lt),L.value?(r(),i("div",Bt,[e("div",Pt,[t[17]||(t[17]=e("h3",{class:"text-xl font-semibold text-center"},"Are you sure you want to delete this conversation?",-1)),e("div",At,[e("button",{onClick:Se,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"},"Yes, Delete"),e("button",{onClick:t[3]||(t[3]=v=>Me(v)),class:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400"},"Cancel")])])])):u("",!0)],8,Dt))),128))])]),e("div",Ft,[m.value?(r(),i("div",Vt,[e("div",qt,[e("h2",zt,n(m.value.chat_partner_name),1),e("button",{onClick:fe,class:"text-gray-500"},"Close")]),e("div",Et,[(r(!0),i(S,null,I(U.value,s=>(r(),i("div",{key:s.id,class:B(["flex items-start space-x-3",{"justify-end":s.sender.id===f.value,"justify-start":s.sender.id!==f.value}])},[s.sender.id!==f.value?(r(),i("img",{key:0,src:s.sender.avatar||D.value,class:"w-8 h-8 rounded-full"},null,8,Wt)):u("",!0),e("div",{class:B(["p-3 rounded-lg shadow-md w-auto max-w-xs",{"bg-green-500 text-white":s.sender.id===f.value,"bg-gray-200 text-black":s.sender.id!==f.value}])},[e("p",{class:B(["text-sm font-bold",{"text-white":s.sender.id===f.value,"text-green-600":s.sender.id!==f.value}])},n(s.sender.id===f.value?"You":s.sender.first_name+" "+s.sender.last_name),3),e("p",Ut,n(s.message),1)],2),s.sender.id===f.value?(r(),i("img",{key:1,src:re.value||D.value,class:"w-8 h-8 rounded-full"},null,8,Ot)):u("",!0)],2))),128))]),e("div",Qt,[X(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>C.message=s),type:"text",placeholder:"Type a message...",class:"flex-1 p-2 border rounded-md text-sm"},null,512),[[Z,C.message]]),e("button",{onClick:_e,class:"ml-2 bg-green-500 text-white px-4 py-2 rounded-md transition duration-200 hover:bg-green-700"}," Send ")])])):(r(),i("div",Nt,t[18]||(t[18]=[e("p",{class:"text-xl"},"Welcome to Pagsasaka Chat",-1)])))])])])):u("",!0)]),d(Pe)],64)}}};export{ts as default};
